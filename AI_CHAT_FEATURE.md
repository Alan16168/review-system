# AI对话功能说明

## 功能概述

在学习资源库中新增了"与AI对话"功能，基于 Google Gemini API 开发，提供智能问答服务。用户可以向系统复盘专家AI提问，获得多角度的专业回答，并且AI会预测用户可能关心的下一个问题。

## 功能特点

### 1. 系统复盘专家角色
- AI 扮演系统复盘资深专家角色
- 针对用户问题提供2-3个不同角度的专业回答
- 回答包含方法论、实践经验、工具应用等多个维度

### 2. 智能预测问题
- 每次回答后，AI会预测3个用户可能想问的下一个问题
- 预测问题显示在对话框底部
- 用户可以直接点击预测问题快速提问

### 3. 优雅的用户界面
- 渐变色背景的对话按钮（紫色到靛蓝色）
- 全屏模态对话框设计
- 清晰的用户消息和AI消息区分
- 流畅的动画效果和交互体验

### 4. 多语言支持
- 支持中文、英文、日语、西班牙语
- 根据用户语言设置自动切换界面文本
- AI回答内容也会根据语言适配

### 5. Mock数据支持
- 当未配置 Google Gemini API Key 时，系统会返回预设的Mock数据
- 确保功能在开发和演示环境下正常运行
- Mock数据也包含多角度回答和预测问题

## 技术实现

### 后端实现

**API端点**: `POST /api/resources/ai-chat`

**请求参数**:
```json
{
  "question": "用户的问题"
}
```

**响应格式**:
```json
{
  "answer": "AI的回答（包含多个角度）",
  "nextQuestions": [
    "预测问题1",
    "预测问题2",
    "预测问题3"
  ],
  "source": "gemini_ai" // 或 "mock"
}
```

**Prompt设计**:
```
作为系统复盘资深专家，回答以下问题：

【用户问题】
{用户的问题}

【输出要求】
请以JSON格式输出，包含以下字段：
1. "perspectives": 数组，包含2-3个不同角度的回答
2. "nextQuestions": 数组，包含3个用户可能会问的下一个问题
```

### 前端实现

**UI组件**:
- AI对话按钮：位于学习资源库的Tab栏中
- 对话模态框：包含消息历史区、预测问题区、输入区

**交互流程**:
1. 用户点击"与AI对话"按钮
2. 打开模态对话框
3. 用户输入问题或点击预测问题
4. 发送请求到后端API
5. 显示加载动画
6. 接收AI回答并显示
7. 显示预测问题供用户快速提问

**JavaScript函数**:
- `openAIChat()`: 打开对话框
- `closeAIChat()`: 关闭对话框
- `sendAIQuestion(questionText)`: 发送问题
- `addMessageToChat(sender, content)`: 添加消息
- `showPredictedQuestions(questions)`: 显示预测问题

## 使用说明

### 用户使用步骤

1. 访问系统首页，滚动到"学习资源库"部分
2. 点击紫色的"与AI对话"按钮
3. 在输入框中输入您的问题，或者点击预测问题
4. 查看AI提供的多角度回答
5. 如果想继续提问，可以：
   - 直接输入新问题
   - 点击AI预测的问题
6. 完成后点击右上角的关闭按钮

### 管理员配置

如果想启用真实的AI功能（而不是Mock数据），需要配置 Google Gemini API Key：

1. 获取 Gemini API Key
   - 访问 Google AI Studio: https://makersuite.google.com/app/apikey
   - 创建或获取您的API Key

2. 配置环境变量
   - 在 `.dev.vars` 文件中添加：
     ```
     GEMINI_API_KEY=your_api_key_here
     ```
   - 或在生产环境中设置环境变量：
     ```bash
     npx wrangler secret put GEMINI_API_KEY
     ```

3. 重启服务
   ```bash
   npm run build
   pm2 restart review-system
   ```

## 文件修改清单

### 1. 后端文件
- `src/routes/resources.ts`
  - 添加 `/ai-chat` POST 端点
  - 实现 Gemini API 调用逻辑
  - 添加 Mock 数据生成函数

### 2. 前端文件
- `public/static/app.js`
  - 添加 AI 对话按钮到资源Tab栏
  - 实现对话模态框 HTML 结构
  - 实现对话功能的 JavaScript 函数
  - 实现预测问题点击功能

- `public/static/i18n.js`
  - 添加中文翻译（zh）
  - 添加英文翻译（en）
  - 添加日语翻译（ja）
  - 添加西班牙语翻译（es）

## 功能演示

### 示例对话

**用户**: 如何做好项目复盘？

**AI回答**:

**从方法论角度**
针对"如何做好项目复盘？"这个问题，建议采用系统化的复盘方法。首先要明确目标和预期，然后收集相关数据和事实，再进行深入分析，最后总结经验教训并制定改进措施。

**从实践经验角度**
根据以往的实践经验，处理"如何做好项目复盘？"时需要注意以下几点：保持客观性，避免个人偏见；注重数据支撑，而非主观臆断；重视团队讨论，集思广益；及时记录和跟进改进措施。

**从工具应用角度**
解决"如何做好项目复盘？"可以运用多种工具和框架，例如：PDCA循环、五问法（5 Whys）、鱼骨图分析、SWOT分析等。选择合适的工具能够帮助更系统地分析问题并找到解决方案。

**您可能还想问**：
- 如何建立有效的复盘机制？
- 复盘过程中常见的误区有哪些？
- 如何确保复盘结果能够落地执行？

## 未来优化方向

1. **对话历史持久化**
   - 将对话历史保存到数据库
   - 用户可以查看历史对话记录

2. **上下文理解**
   - AI记住之前的对话内容
   - 提供更连贯的多轮对话体验

3. **个性化推荐**
   - 根据用户的复盘记录
   - 提供个性化的问题和建议

4. **语音输入**
   - 支持语音输入问题
   - 语音朗读AI回答

5. **知识库集成**
   - 将AI回答与文章、视频资源关联
   - 提供更多学习材料链接

## 部署信息

- **开发环境**: http://localhost:3000
- **生产环境**: https://your-domain.pages.dev
- **API端点**: /api/resources/ai-chat
- **依赖服务**: Google Gemini API

## 技术栈

- **后端**: Hono + TypeScript + Cloudflare Workers
- **前端**: Vanilla JavaScript + TailwindCSS + Font Awesome
- **AI服务**: Google Gemini Pro API
- **国际化**: 自定义 i18n 实现

## 联系方式

如有问题或建议，请联系开发团队。
