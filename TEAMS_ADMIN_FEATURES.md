# 团队管理和管理后台功能说明

## 🎉 新增功能概览

本次更新完成了以下两大核心功能模块：
1. **团队管理系统** - 高级用户和管理员专属
2. **管理后台系统** - 管理员专属

---

## 👥 团队管理功能

### 功能概述
团队管理功能允许高级用户（Premium）和管理员创建团队、邀请成员，并实现团队复盘的协作编辑。

### 权限说明
- **高级用户（Premium）**: 可以创建和管理团队
- **管理员（Admin）**: 拥有所有团队管理权限
- **普通用户（User）**: 可以被邀请加入团队，但不能创建团队

---

### 1. 团队列表页面

#### 页面功能
- **展示所有团队**: 以卡片形式展示用户加入的所有团队
- **团队信息**: 显示团队名称、描述、拥有者、成员数量
- **创建团队**: 右上角"创建团队"按钮
- **快速操作**: 每个团队卡片上有查看和删除按钮

#### 卡片内容
```
┌────────────────────────────────┐
│ 产品开发团队        [拥有者]   │
│ 负责产品迭代和功能开发          │
│                                │
│ Premium User    👥 5成员       │
│ [查看] [删除]                  │
└────────────────────────────────┘
```

#### 空状态
- 没有团队时显示友好提示
- 提供快捷"创建团队"按钮

---

### 2. 创建团队功能

#### 表单字段
- **团队名称** (必填)
  - 输入框：简洁的团队名称
  - 示例："产品开发团队"

- **团队描述** (可选)
  - 多行文本框：详细的团队说明
  - 示例："负责产品迭代和功能开发"

#### 操作流程
1. 点击"创建团队"按钮
2. 填写团队名称和描述
3. 点击"保存"
4. 自动成为团队拥有者
5. 自动加入团队成员列表
6. 跳转到团队列表页

---

### 3. 团队详情页面

#### 页面结构
```
┌─────────────────────────────────────┐
│ [← 返回]                            │
│                                     │
│ 产品开发团队           [解散团队]   │
│ 负责产品迭代和功能开发               │
│ 👤 Premium User | 📅 2025-10-07    │
├─────────────────────────────────────┤
│ 邀请成员 (仅拥有者可见)             │
│ [邮箱输入框] [邀请成员]             │
├─────────────────────────────────────┤
│ 团队成员 (5)                        │
│ ┌───────────────────────────────┐  │
│ │ 👤 Admin                      │  │
│ │    admin@review.com           │  │
│ │    [管理员] [拥有者]    [移除]│  │
│ └───────────────────────────────┘  │
│ ┌───────────────────────────────┐  │
│ │ 👤 User                       │  │
│ │    user@review.com            │  │
│ │    [用户]              [移除] │  │
│ └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

#### 功能说明

**邀请成员（拥有者专属）**
- 输入邮箱搜索用户
- 系统验证用户是否存在
- 防止重复邀请
- 即时添加成员到团队

**成员列表**
- 显示所有团队成员
- 显示成员角色标签
- 显示团队拥有者标识
- 拥有者可以移除其他成员

**权限控制**
- **拥有者**: 
  - 可以邀请成员
  - 可以移除成员
  - 可以解散团队
- **普通成员**: 
  - 可以查看成员列表
  - 可以退出团队
  - 不能邀请或移除成员

---

### 4. 团队与复盘的关联

#### 创建团队复盘
1. 在创建复盘页面选择团队
2. 系统自动设置为团队复盘
3. 团队所有成员可见该复盘
4. 协作者可以编辑内容

#### 权限模型
```
复盘创建者 → 完全控制权
  ├─ 可以编辑所有内容
  ├─ 可以添加协作者
  ├─ 可以设置协作者权限
  └─ 可以删除复盘

团队成员（协作者）→ 根据权限
  ├─ 可编辑: 可以修改内容
  └─ 只读: 只能查看

非团队成员 → 无权限
  └─ 完全不可见
```

#### 邀请机制
- **必须先有账号**: 被邀请者必须已注册系统账号
- **通过邮箱识别**: 输入邮箱查找用户
- **即时生效**: 邀请成功后立即加入团队
- **自动权限**: 新成员自动获得查看团队复盘的权限

---

## 🛠️ 管理后台功能

### 功能概述
管理后台是系统管理员的专属功能区，提供用户管理、通知发送和系统统计等核心管理功能。

### 权限说明
- **仅管理员可访问**: 普通用户和高级用户无法访问
- **完全控制权**: 可以管理所有用户和系统资源

---

### 1. 用户管理标签页

#### 功能列表

**A. 用户列表展示**
- 表格形式展示所有用户
- 显示信息：
  - 头像图标
  - 用户名
  - 邮箱
  - 角色（可修改）
  - 注册时间
  - 操作按钮

**B. 用户搜索**
- 实时搜索
- 支持按用户名搜索
- 支持按邮箱搜索

**C. 批量选择**
- 全选复选框
- 单个用户复选框
- 用于批量发送通知

**D. 用户角色管理**
- 下拉选择框修改角色
- 三种角色：
  - User（普通用户）
  - Premium（高级用户）
  - Admin（管理员）
- 即时保存，无需额外确认
- 不能修改自己的角色

**E. 删除用户**
- 删除按钮（垃圾桶图标）
- 需要确认操作
- 不能删除自己
- 级联删除：
  - 用户创建的复盘
  - 用户创建的团队
  - 用户的通知记录

---

### 2. 群发通知标签页

#### 功能分区

**A. 广播消息（发送给所有用户）**

表单字段：
- **通知标题** (必填)
  - 简短的标题
  - 示例："系统维护通知"

- **通知内容** (必填)
  - 详细的通知信息
  - 支持多行文本
  - 示例："系统将于今晚22:00-24:00进行维护，请提前保存工作"

操作流程：
1. 填写通知标题和内容
2. 点击"发送给所有用户"按钮
3. 系统发送给所有注册用户
4. 显示成功提示和接收人数

**B. 发送给选中用户**

表单字段：
- **通知标题** (必填)
- **通知内容** (必填)

使用流程：
1. 切换到"用户管理"标签页
2. 勾选目标用户的复选框
3. 切换回"群发通知"标签页
4. 填写通知内容
5. 点击"发送给选中用户"
6. 系统发送给选中的用户
7. 显示成功提示和接收人数

注意事项：
- 必须先选择用户
- 未选择用户时会提示错误
- 选中状态在标签页切换时保持

---

### 3. 系统统计标签页

#### 统计卡片

**A. 总用户数**
- 显示系统注册用户总数
- 蓝色图标和数字
- 实时统计

**B. 总复盘数**
- 显示系统中所有复盘记录数
- 绿色图标和数字
- 包含个人和团队复盘

**C. 总团队数**
- 显示系统中所有团队数量
- 紫色图标和数字
- 实时统计

**D. 用户角色分布**
- 饼状展示（卡片形式）
- 显示各角色用户数量：
  - 管理员数量（红色）
  - 高级用户数量（紫色）
  - 普通用户数量（灰色）
- 实时更新

#### 页面布局
```
┌─────────────────────────────────────┐
│ [用户管理] [群发通知] [系统统计]    │
├─────────────────────────────────────┤
│                                     │
│ ┌──────┐ ┌──────┐ ┌──────┐         │
│ │总用户│ │总复盘│ │总团队│         │
│ │  10  │ │  25  │ │  5   │         │
│ └──────┘ └──────┘ └──────┘         │
│                                     │
│ 用户角色分布                        │
│ ┌─────────────────────┐            │
│ │ 管理员      2       │            │
│ │ 高级用户    3       │            │
│ │ 普通用户    5       │            │
│ └─────────────────────┘            │
└─────────────────────────────────────┘
```

---

## 🔔 通知系统

### 数据库设计

**notifications 表结构**
```sql
CREATE TABLE notifications (
  id INTEGER PRIMARY KEY,
  user_id INTEGER,              -- 接收用户ID
  title TEXT NOT NULL,          -- 通知标题
  message TEXT NOT NULL,        -- 通知内容
  is_read INTEGER DEFAULT 0,    -- 已读状态
  created_at DATETIME,          -- 创建时间
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 通知类型

**1. 系统广播通知**
- 发送给所有用户
- 用于系统公告
- 示例：维护通知、新功能发布

**2. 定向通知**
- 发送给特定用户
- 用于个性化消息
- 示例：角色变更、权限更新

### API 端点

**发送广播通知**
```bash
POST /api/notifications/broadcast
{
  "title": "通知标题",
  "message": "通知内容"
}
```

**发送给指定用户**
```bash
POST /api/notifications/send
{
  "user_ids": [1, 2, 3],
  "title": "通知标题",
  "message": "通知内容"
}
```

**获取我的通知**
```bash
GET /api/notifications/my
```

**标记已读**
```bash
PUT /api/notifications/:id/read
```

---

## 📊 功能测试清单

### 团队管理测试

#### ✅ 创建团队
- [x] 高级用户可以创建团队
- [x] 普通用户看不到创建按钮
- [x] 表单验证生效
- [x] 创建成功后显示在列表中

#### ✅ 邀请成员
- [x] 通过邮箱查找用户
- [x] 不存在的邮箱显示错误
- [x] 重复邀请显示提示
- [x] 邀请成功后成员列表更新

#### ✅ 团队详情
- [x] 显示团队基本信息
- [x] 显示成员列表
- [x] 拥有者标识正确
- [x] 角色标签显示正确

#### ✅ 权限控制
- [x] 拥有者可以邀请成员
- [x] 拥有者可以移除成员
- [x] 普通成员只能查看
- [x] 拥有者可以解散团队

#### ✅ 团队复盘
- [x] 创建时可选择团队
- [x] 团队成员可见团队复盘
- [x] 非团队成员不可见
- [x] 协作权限生效

---

### 管理后台测试

#### ✅ 用户管理
- [x] 显示所有用户列表
- [x] 搜索功能正常
- [x] 修改角色即时生效
- [x] 删除用户功能正常
- [x] 不能修改/删除自己
- [x] 批量选择功能正常

#### ✅ 群发通知
- [x] 广播通知发送成功
- [x] 显示接收人数
- [x] 选中用户发送成功
- [x] 未选择用户时提示
- [x] 表单验证生效

#### ✅ 系统统计
- [x] 显示正确的用户数
- [x] 显示正确的复盘数
- [x] 显示正确的团队数
- [x] 角色分布数据正确
- [x] 数据实时更新

---

## 🔐 权限矩阵

### 团队功能权限

| 功能 | 普通用户 | 高级用户 | 管理员 |
|------|---------|---------|--------|
| 查看团队列表 | ❌ | ✅ | ✅ |
| 创建团队 | ❌ | ✅ | ✅ |
| 邀请成员 | ❌ | ✅ (仅自己的团队) | ✅ |
| 移除成员 | ❌ | ✅ (仅自己的团队) | ✅ |
| 解散团队 | ❌ | ✅ (仅自己的团队) | ✅ |
| 加入团队 | ✅ (被邀请) | ✅ | ✅ |
| 退出团队 | ✅ | ✅ | ✅ |
| 查看团队复盘 | ✅ (团队成员) | ✅ (团队成员) | ✅ |

### 管理后台权限

| 功能 | 普通用户 | 高级用户 | 管理员 |
|------|---------|---------|--------|
| 访问管理后台 | ❌ | ❌ | ✅ |
| 查看用户列表 | ❌ | ❌ | ✅ |
| 修改用户角色 | ❌ | ❌ | ✅ |
| 删除用户 | ❌ | ❌ | ✅ |
| 发送广播通知 | ❌ | ❌ | ✅ |
| 发送定向通知 | ❌ | ❌ | ✅ |
| 查看系统统计 | ❌ | ❌ | ✅ |

---

## 💡 使用场景示例

### 场景1：创建团队并邀请成员

**步骤**：
1. Premium用户登录系统
2. 点击"团队"导航
3. 点击"创建团队"
4. 输入团队名称："前端开发团队"
5. 输入描述："负责前端技术架构和开发"
6. 点击"保存"
7. 系统创建团队并跳转到团队列表
8. 点击查看团队详情
9. 在邀请成员输入框输入：user@review.com
10. 点击"邀请成员"
11. 系统查找用户并添加到团队
12. 成员列表更新，显示新成员

### 场景2：团队协作复盘

**步骤**：
1. Premium用户创建复盘
2. 在团队选择框选择："前端开发团队"
3. 填写复盘内容
4. 保存复盘
5. 团队成员登录系统
6. 在"我的复盘"列表中看到团队复盘
7. 点击编辑，添加自己的观点
8. 保存更新
9. 拥有者可以看到成员的补充内容

### 场景3：管理员发送系统通知

**步骤**：
1. Admin用户登录系统
2. 点击"管理后台"导航
3. 切换到"群发通知"标签页
4. 填写标题："系统维护通知"
5. 填写内容："系统将于今晚22:00进行维护"
6. 点击"发送给所有用户"
7. 系统显示：通知已发送 5 用户
8. 所有用户收到通知记录

### 场景4：管理员调整用户角色

**步骤**：
1. Admin用户进入管理后台
2. 在用户列表中找到目标用户
3. 点击角色下拉框
4. 选择"Premium"
5. 系统即时保存
6. 用户刷新页面后看到新权限
7. 用户导航栏显示"团队"选项

---

## 🔧 技术实现

### 前端技术

**团队管理**
- 卡片式布局展示团队
- 响应式网格系统
- 即时成员更新
- 邀请验证反馈

**管理后台**
- 标签页切换
- 表格排序和筛选
- 复选框批量操作
- 实时数据更新

### 后端技术

**团队 API**
- RESTful 设计
- 权限验证中间件
- 级联查询优化
- 事务处理

**通知系统**
- 批量插入优化
- 异步处理（可扩展）
- 邮件集成接口（预留）
- 推送通知接口（预留）

### 数据库优化

**索引优化**
```sql
-- 团队成员查询优化
CREATE INDEX idx_team_members_team_id ON team_members(team_id);
CREATE INDEX idx_team_members_user_id ON team_members(user_id);

-- 通知查询优化
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_created_at ON notifications(created_at);
```

**查询优化**
- 使用 JOIN 减少查询次数
- 合理使用 DISTINCT
- 分页查询（预留）
- 缓存热点数据（预留）

---

## 📝 API 文档补充

### 团队管理 API

**获取团队列表**
```
GET /api/teams
Headers: Authorization: Bearer {token}
Response: {
  "teams": [
    {
      "id": 1,
      "name": "团队名称",
      "description": "团队描述",
      "owner_id": 2,
      "owner_name": "拥有者",
      "member_count": 5,
      "created_at": "2025-10-07",
      "updated_at": "2025-10-07"
    }
  ]
}
```

**创建团队**
```
POST /api/teams
Headers: Authorization: Bearer {token}
Body: {
  "name": "团队名称",
  "description": "团队描述"
}
Response: {
  "id": 1,
  "message": "Team created successfully"
}
```

**获取团队详情**
```
GET /api/teams/:id
Headers: Authorization: Bearer {token}
Response: {
  "team": {...},
  "members": [...]
}
```

**添加团队成员**
```
POST /api/teams/:id/members
Headers: Authorization: Bearer {token}
Body: {
  "user_id": 3
}
Response: {
  "message": "Member added successfully"
}
```

**移除团队成员**
```
DELETE /api/teams/:id/members/:userId
Headers: Authorization: Bearer {token}
Response: {
  "message": "Member removed successfully"
}
```

**删除团队**
```
DELETE /api/teams/:id
Headers: Authorization: Bearer {token}
Response: {
  "message": "Team deleted successfully"
}
```

### 通知管理 API

**广播通知**
```
POST /api/notifications/broadcast
Headers: Authorization: Bearer {token}
Body: {
  "title": "通知标题",
  "message": "通知内容"
}
Response: {
  "message": "Notification sent successfully",
  "recipient_count": 10
}
```

**发送给指定用户**
```
POST /api/notifications/send
Headers: Authorization: Bearer {token}
Body: {
  "user_ids": [1, 2, 3],
  "title": "通知标题",
  "message": "通知内容"
}
Response: {
  "message": "Notification sent successfully",
  "recipient_count": 3
}
```

---

## 🎯 总结

### 已完成功能

✅ **团队管理系统**
- 创建团队
- 邀请成员（通过邮箱）
- 团队详情查看
- 成员管理
- 权限控制
- 团队复盘协作

✅ **管理后台系统**
- 用户列表展示
- 用户搜索和筛选
- 用户角色管理（增删查改）
- 用户删除功能
- 群发通知功能
- 定向通知功能
- 系统统计数据

✅ **通知系统**
- 通知数据库设计
- 广播通知 API
- 定向通知 API
- 通知记录保存

### 技术亮点

1. **完善的权限控制**: 三级权限体系
2. **灵活的邀请机制**: 通过邮箱识别用户
3. **实时数据更新**: 操作即时反馈
4. **友好的用户体验**: 清晰的提示和反馈
5. **可扩展架构**: 预留邮件和推送接口

### 下一步扩展

1. **通知前端展示**: 添加通知中心和消息提醒
2. **邮件通知**: 集成邮件服务
3. **推送通知**: 集成推送服务
4. **数据导出**: 导出用户和统计数据
5. **日志系统**: 记录管理员操作

---

**文档版本**: 3.0
**更新时间**: 2025-10-07
**功能状态**: ✅ 完整实现并测试通过
