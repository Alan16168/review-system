# AI å†™ä½œåŠ©æ‰‹ç³»ç»Ÿè®¾ç½®åŠŸèƒ½ - 2025-11-20

## åŠŸèƒ½æ¦‚è¿°

åœ¨ç®¡ç†åå°æ·»åŠ äº† **AI å†™ä½œåŠ©æ‰‹è®¾ç½®** åŠŸèƒ½ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡å¯è§†åŒ–ç•Œé¢é…ç½® AI ç”Ÿæˆå†…å®¹çš„æ ¸å¿ƒå‚æ•°ï¼Œæ— éœ€ä¿®æ”¹ä»£ç æˆ–é‡å¯æœåŠ¡ã€‚

## åŠŸèƒ½äº®ç‚¹

âœ¨ **å¯è§†åŒ–é…ç½®ç•Œé¢** - ç›´è§‚çš„è®¾ç½®é¢æ¿ï¼Œå®æ—¶é¢„è§ˆå‚æ•°æ•ˆæœ  
âš¡ **å³æ—¶ç”Ÿæ•ˆ** - ä¿®æ”¹åç«‹å³åº”ç”¨ï¼Œæ— éœ€é‡å¯æœåŠ¡  
ğŸ”’ **ç®¡ç†å‘˜ä¸“å±** - ä»…ç®¡ç†å‘˜è§’è‰²å¯è®¿é—®å’Œä¿®æ”¹  
ğŸ“Š **æ™ºèƒ½é¢„è§ˆ** - å®æ—¶è®¡ç®— Token ä¸å­—æ•°çš„å…³ç³»  
ğŸ›¡ï¸ **å‚æ•°éªŒè¯** - è‡ªåŠ¨éªŒè¯è¾“å…¥å€¼çš„åˆæ³•æ€§

---

## è®¿é—®è·¯å¾„

**ç®¡ç†åå°** â†’ **AI å†™ä½œè®¾ç½®**

```
ç™»å½• â†’ ç‚¹å‡»"ç®¡ç†" â†’ "AI å†™ä½œè®¾ç½®"æ ‡ç­¾é¡µ
```

---

## å¯é…ç½®å‚æ•°

### 1. æœ€å¤§è¾“å‡º Token æ•°é‡ (ai_max_output_tokens)

**è¯´æ˜**ï¼šæ§åˆ¶ AI ç”Ÿæˆå†…å®¹çš„æœ€å¤§é•¿åº¦

| é¡¹ç›® | å€¼ |
|-----|-----|
| **é»˜è®¤å€¼** | 8192 |
| **èŒƒå›´** | 1000 - 8192 |
| **ç±»å‹** | æ•°å­— (number) |
| **å½±å“** | Token æ•°é‡è¶Šå¤§ï¼Œå¯ä»¥ç”Ÿæˆçš„å†…å®¹è¶Šé•¿ |

**ç•Œé¢åŠŸèƒ½**ï¼š
- æ•°å­—è¾“å…¥æ¡†ï¼ˆæ”¯æŒæ‰‹åŠ¨è¾“å…¥ï¼‰
- æ­¥è¿›å€¼ï¼š512
- å®æ—¶é¢„è§ˆï¼šè‡ªåŠ¨è®¡ç®—å¯ç”Ÿæˆçš„å­—æ•°èŒƒå›´
- æ™ºèƒ½æç¤ºï¼šæ˜¾ç¤ºæ¨èç›®æ ‡å­—æ•°

**Token ä¸å­—æ•°å¯¹ç…§è¡¨**ï¼š

| Token æ•° | ä¸­æ–‡å­—æ•°ï¼ˆä¿å®ˆï¼‰ | ä¸­æ–‡å­—æ•°ï¼ˆä¹è§‚ï¼‰ | æ¨èç›®æ ‡ |
|---------|----------------|----------------|---------|
| 2048 | ~680 å­— | ~1024 å­— | 850 å­— |
| 4096 | ~1365 å­— | ~2048 å­— | 1700 å­— |
| 6144 | ~2048 å­— | ~3072 å­— | 2560 å­— |
| 8192 | ~2730 å­— | ~4096 å­— | 3400 å­— |

**é¢„è§ˆä¿¡æ¯**ï¼š
```
ä¸­æ–‡å­—æ•°èŒƒå›´ï¼š2730 - 4096 å­—
æ¨èç›®æ ‡å­—æ•°ï¼š3413 å­—
ç”Ÿæˆé€Ÿåº¦ï¼š82 - 164 ç§’
```

---

### 2. åˆ›æ„åº¦ (ai_temperature)

**è¯´æ˜**ï¼šæ§åˆ¶ AI ç”Ÿæˆå†…å®¹çš„éšæœºæ€§å’Œåˆ›æ„æ€§

| é¡¹ç›® | å€¼ |
|-----|-----|
| **é»˜è®¤å€¼** | 0.7 |
| **èŒƒå›´** | 0.0 - 1.0 |
| **ç±»å‹** | æ•°å­— (number) |
| **å½±å“** | å€¼è¶Šé«˜è¶Šæœ‰åˆ›æ„ï¼Œå€¼è¶Šä½è¶Šç¨³å®šä¸€è‡´ |

**ç•Œé¢åŠŸèƒ½**ï¼š
- æ»‘åŠ¨æ¡ï¼ˆå¯è§†åŒ–è°ƒèŠ‚ï¼‰
- æ­¥è¿›å€¼ï¼š0.1
- å®æ—¶æ˜¾ç¤ºå½“å‰å€¼
- æ¨èè®¾ç½®è¯´æ˜

**æ¨èè®¾ç½®**ï¼š

| åˆ›æ„åº¦ | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|-------|---------|------|
| **0.3-0.5** | ä¸“ä¸šæ–‡æ¡£ã€æŠ€æœ¯æ–‡ç«  | ç¨³å®šã€ä¸€è‡´ã€ä¸¥è°¨ |
| **0.7** | ä¸€èˆ¬å†…å®¹ï¼ˆæ¨èï¼‰ | å¹³è¡¡åˆ›æ„ä¸ç¨³å®šæ€§ |
| **0.8-1.0** | åˆ›æ„å†™ä½œã€è¥é”€æ–‡æ¡ˆ | å¯Œæœ‰å˜åŒ–ã€æ›´æœ‰åˆ›æ„ |

---

### 3. é»˜è®¤ç›®æ ‡å­—æ•° (ai_default_word_count)

**è¯´æ˜**ï¼šåˆ›å»ºæ–°å°èŠ‚æ—¶çš„é»˜è®¤å­—æ•°è®¾ç½®

| é¡¹ç›® | å€¼ |
|-----|-----|
| **é»˜è®¤å€¼** | 1000 |
| **èŒƒå›´** | 100 - 5000 |
| **ç±»å‹** | æ•°å­— (number) |
| **å½±å“** | ç”¨æˆ·åˆ›å»ºå°èŠ‚æ—¶çš„åˆå§‹å­—æ•°å€¼ |

**ç•Œé¢åŠŸèƒ½**ï¼š
- æ•°å­—è¾“å…¥æ¡†
- æ­¥è¿›å€¼ï¼š100
- å­—æ•°å»ºè®®è¯´æ˜

**å­—æ•°å»ºè®®**ï¼š

| å­—æ•°èŒƒå›´ | é€‚ç”¨åœºæ™¯ | è¯´æ˜ |
|---------|---------|------|
| **500-1000** | ç®€ä»‹ã€æ¦‚è¿°æ€§å†…å®¹ | ç®€æ´æ˜äº† |
| **1000-2000** | æ ‡å‡†æ–‡ç« é•¿åº¦ | æ¨èä½¿ç”¨ |
| **2000-3000** | æ·±åº¦åˆ†æã€è¯¦ç»†è¯´æ˜ | è¯¦ç»†æ·±å…¥ |
| **3000+** | è¶…é•¿å†…å®¹ | âš ï¸ å¯èƒ½å— Token é™åˆ¶ |

---

### 4. å¯ç”¨ AI å†™ä½œåŠŸèƒ½ (ai_enabled)

**è¯´æ˜**ï¼šå…¨å±€å¼€å…³ï¼Œæ§åˆ¶æ˜¯å¦å¯ç”¨ AI å†™ä½œåŠŸèƒ½

| é¡¹ç›® | å€¼ |
|-----|-----|
| **é»˜è®¤å€¼** | trueï¼ˆå¯ç”¨ï¼‰ |
| **ç±»å‹** | å¸ƒå°”å€¼ (boolean) |
| **å½±å“** | å…³é—­åç”¨æˆ·æ— æ³•ä½¿ç”¨ AI ç”Ÿæˆå†…å®¹ |

**ç•Œé¢åŠŸèƒ½**ï¼š
- å¼€å…³æŒ‰é’®ï¼ˆToggleï¼‰
- ä¸€é”®å¯ç”¨/ç¦ç”¨
- çŠ¶æ€æ¸…æ™°å¯è§

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… **ç»´æŠ¤æœŸé—´**ï¼šä¸´æ—¶å…³é—­ AI åŠŸèƒ½è¿›è¡Œç³»ç»Ÿç»´æŠ¤
- âœ… **æ•…éšœå¤„ç†**ï¼šAPI æ•…éšœæ—¶å¿«é€Ÿç¦ç”¨é¿å…é”™è¯¯
- âœ… **æˆæœ¬æ§åˆ¶**ï¼šæ§åˆ¶ API è°ƒç”¨æˆæœ¬
- âœ… **æµ‹è¯•ç¯å¢ƒ**ï¼šåŒºåˆ†æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒ

---

## æŠ€æœ¯å®ç°

### æ•°æ®åº“è®¾è®¡

**è¡¨å**ï¼š`system_settings`

```sql
CREATE TABLE system_settings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  setting_key TEXT UNIQUE NOT NULL,
  setting_value TEXT NOT NULL,
  setting_type TEXT NOT NULL DEFAULT 'string',
  category TEXT NOT NULL DEFAULT 'general',
  description TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| `id` | INTEGER | ä¸»é”® |
| `setting_key` | TEXT | è®¾ç½®é”®åï¼ˆå”¯ä¸€ï¼‰ |
| `setting_value` | TEXT | è®¾ç½®å€¼ï¼ˆå­—ç¬¦ä¸²å­˜å‚¨ï¼‰ |
| `setting_type` | TEXT | å€¼ç±»å‹ï¼ˆstring/number/boolean/jsonï¼‰ |
| `category` | TEXT | åˆ†ç±»ï¼ˆai_writing/general ç­‰ï¼‰ |
| `description` | TEXT | è¯´æ˜æ–‡å­— |
| `created_at` | DATETIME | åˆ›å»ºæ—¶é—´ |
| `updated_at` | DATETIME | æ›´æ–°æ—¶é—´ |

**é»˜è®¤æ•°æ®**ï¼š

```sql
INSERT INTO system_settings (setting_key, setting_value, setting_type, category, description) VALUES
  ('ai_max_output_tokens', '8192', 'number', 'ai_writing', 'Gemini API æœ€å¤§è¾“å‡º Token æ•°é‡'),
  ('ai_temperature', '0.7', 'number', 'ai_writing', 'AI ç”Ÿæˆå†…å®¹çš„åˆ›æ„åº¦'),
  ('ai_default_word_count', '1000', 'number', 'ai_writing', 'é»˜è®¤ç›®æ ‡å­—æ•°'),
  ('ai_enabled', 'true', 'boolean', 'ai_writing', 'æ˜¯å¦å¯ç”¨ AI å†™ä½œåŠŸèƒ½');
```

---

### API è·¯ç”±

**åŸºç¡€è·¯å¾„**ï¼š`/api/system-settings`

#### è·å–æ‰€æœ‰è®¾ç½®
```http
GET /api/system-settings
Authorization: Bearer {admin_token}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "settings": [
    {
      "id": 1,
      "setting_key": "ai_max_output_tokens",
      "setting_value": "8192",
      "setting_type": "number",
      "category": "ai_writing",
      "description": "Gemini API æœ€å¤§è¾“å‡º Token æ•°é‡"
    }
  ]
}
```

#### è·å–åˆ†ç±»è®¾ç½®
```http
GET /api/system-settings/category/ai_writing
```

**å“åº”**ï¼šè¿”å› AI å†™ä½œç›¸å…³çš„æ‰€æœ‰è®¾ç½®

#### æ›´æ–°å•ä¸ªè®¾ç½®
```http
PUT /api/system-settings/:key
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "value": 8192
}
```

#### æ‰¹é‡æ›´æ–°è®¾ç½®
```http
PUT /api/system-settings/batch/update
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "settings": [
    { "key": "ai_max_output_tokens", "value": 8192 },
    { "key": "ai_temperature", "value": 0.7 }
  ]
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "updated_count": 2,
  "message": "Updated 2 setting(s)"
}
```

---

### å‰ç«¯å®ç°

**æ–‡ä»¶**ï¼š`/home/user/webapp/public/static/app.js`

**ä¸»è¦å‡½æ•°**ï¼š

#### 1. æ˜¾ç¤ºè®¾ç½®é¡µé¢
```javascript
async function showAISettingsManagement(container) {
  // æ¸²æŸ“è®¾ç½®ç•Œé¢
  // åŠ è½½å½“å‰è®¾ç½®
}
```

#### 2. åŠ è½½è®¾ç½®æ•°æ®
```javascript
async function loadAISettings() {
  const response = await axios.get('/api/system-settings/category/ai_writing');
  // å¡«å……è¡¨å•
  // åˆå§‹åŒ–é¢„è§ˆ
}
```

#### 3. æ›´æ–° Token é¢„è§ˆ
```javascript
function updateTokenPreview(tokens) {
  // è®¡ç®—å­—æ•°èŒƒå›´
  // æ›´æ–°é¢„è§ˆä¿¡æ¯
}
```

#### 4. ä¿å­˜è®¾ç½®
```javascript
async function saveAISettings() {
  // éªŒè¯è¾“å…¥
  // æ‰¹é‡æ›´æ–°
  // æ˜¾ç¤ºç»“æœ
}
```

---

### åç«¯é›†æˆ

**æ–‡ä»¶**ï¼š`/home/user/webapp/src/routes/ai_books.ts`

#### è¯»å–ç³»ç»Ÿè®¾ç½®
```typescript
async function getSystemSetting(DB: D1Database, key: string, defaultValue: any): Promise<any> {
  const setting = await DB.prepare(`
    SELECT setting_value, setting_type FROM system_settings WHERE setting_key = ?
  `).bind(key).first();

  // æ ¹æ®ç±»å‹è§£æå€¼
  if (setting.setting_type === 'number') {
    return parseFloat(setting.setting_value);
  }
  // ...
}
```

#### åº”ç”¨åˆ°ç”Ÿæˆé€»è¾‘
```typescript
// è·å–ç³»ç»Ÿè®¾ç½®
const systemMaxTokens = await getSystemSetting(c.env.DB, 'ai_max_output_tokens', 8192);
const systemTemperature = await getSystemSetting(c.env.DB, 'ai_temperature', 0.7);
const systemEnabled = await getSystemSetting(c.env.DB, 'ai_enabled', true);

// æ£€æŸ¥æ˜¯å¦å¯ç”¨
if (!systemEnabled) {
  return c.json({ error: 'AI å†™ä½œåŠŸèƒ½å·²è¢«ç®¡ç†å‘˜ç¦ç”¨' }, 503);
}

// è®¡ç®— Token æ•°é‡
const maxTokens = Math.min(estimatedTokens, systemMaxTokens);

// è°ƒç”¨ API
const content = await callGeminiAPI(apiKey, prompt, maxTokens, systemTemperature);
```

---

## ç”¨æˆ·ç•Œé¢

### ç®¡ç†åå°æ ‡ç­¾é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç®¡ç†åå°                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç”¨æˆ·ç®¡ç†] [æ¨¡æ¿ç®¡ç†] [é€šçŸ¥] [ç»Ÿè®¡] [AI å†™ä½œè®¾ç½®] â† æ–°å¢ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AI è®¾ç½®é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI æ™ºèƒ½å†™ä½œåŠ©æ‰‹è®¾ç½®                          [ä¿å­˜è®¾ç½®]  â”‚
â”‚ é…ç½® AI ç”Ÿæˆå†…å®¹çš„å‚æ•°                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ ğŸ“Š æœ€å¤§è¾“å‡º Token æ•°é‡                      [æ ¸å¿ƒå‚æ•°]      â”‚
â”‚ æ§åˆ¶ AI ç”Ÿæˆå†…å®¹çš„æœ€å¤§é•¿åº¦                                  â”‚
â”‚                                                             â”‚
â”‚ Token æ•°é‡: [8192â–¼]    â”‚ é¢„ä¼°ç”Ÿæˆèƒ½åŠ›ï¼š                    â”‚
â”‚ èŒƒå›´: 1000-8192        â”‚ â€¢ ä¸­æ–‡å­—æ•°ï¼š2730-4096 å­—           â”‚
â”‚                        â”‚ â€¢ æ¨èç›®æ ‡ï¼š3413 å­—               â”‚
â”‚                        â”‚ â€¢ ç”Ÿæˆé€Ÿåº¦ï¼š82-164 ç§’             â”‚
â”‚                                                             â”‚
â”‚ â„¹ï¸ Token ä¸å­—æ•°å…³ç³»                                         â”‚
â”‚ â€¢ ä¸­æ–‡å†…å®¹ï¼š1 ä¸ªä¸­æ–‡å­— â‰ˆ 2-3 tokens                         â”‚
â”‚ â€¢ 2048 tokensï¼šçº¦ 700-1000 ä¸­æ–‡å­—                          â”‚
â”‚ â€¢ 8192 tokensï¼šçº¦ 2700-4000 ä¸­æ–‡å­—                         â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ ğŸŒ¡ï¸ åˆ›æ„åº¦ (Temperature)                                     â”‚
â”‚ æ§åˆ¶ AI ç”Ÿæˆå†…å®¹çš„éšæœºæ€§å’Œåˆ›æ„æ€§                             â”‚
â”‚                                                             â”‚
â”‚ [â”â”â”â”â”â”â”â—â”â”â”â”â”â”â”â”]                                           â”‚
â”‚ ä¿å®ˆ (0)    0.7    åˆ›æ„ (1)                                â”‚
â”‚                                                             â”‚
â”‚ æ¨èè®¾ç½®ï¼š                                                   â”‚
â”‚ â€¢ 0.3-0.5ï¼šä¸“ä¸šæ–‡æ¡£ã€æŠ€æœ¯æ–‡ç«                                 â”‚
â”‚ â€¢ 0.7ï¼šä¸€èˆ¬å†…å®¹ï¼ˆæ¨èï¼‰                                       â”‚
â”‚ â€¢ 0.8-1.0ï¼šåˆ›æ„å†™ä½œã€è¥é”€æ–‡æ¡ˆ                                â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ ğŸ“ é»˜è®¤ç›®æ ‡å­—æ•°                                              â”‚
â”‚ åˆ›å»ºæ–°å°èŠ‚æ—¶çš„é»˜è®¤å­—æ•°è®¾ç½®                                    â”‚
â”‚                                                             â”‚
â”‚ [1000]                 â”‚ å­—æ•°å»ºè®®ï¼š                         â”‚
â”‚ èŒƒå›´: 100-5000         â”‚ â€¢ 500-1000 å­—ï¼šç®€ä»‹ã€æ¦‚è¿°          â”‚
â”‚                        â”‚ â€¢ 1000-2000 å­—ï¼šæ ‡å‡†é•¿åº¦ï¼ˆæ¨èï¼‰    â”‚
â”‚                        â”‚ â€¢ 2000-3000 å­—ï¼šæ·±åº¦åˆ†æ           â”‚
â”‚                        â”‚ âš ï¸ è¶…è¿‡ 3000 å­—å¯èƒ½å—é™åˆ¶           â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ ğŸ”Œ å¯ç”¨ AI å†™ä½œåŠŸèƒ½                              [â—å¼€å¯]     â”‚
â”‚ å…¨å±€å¼€å…³ï¼Œå…³é—­åç”¨æˆ·å°†æ— æ³•ä½¿ç”¨ AI å†™ä½œåŠ©æ‰‹åŠŸèƒ½                 â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ âš ï¸ é‡è¦æç¤º                                                  â”‚
â”‚ â€¢ ä¿®æ”¹è¿™äº›è®¾ç½®å°†å½±å“æ‰€æœ‰ç”¨æˆ·çš„ AI å†…å®¹ç”Ÿæˆ                      â”‚
â”‚ â€¢ å»ºè®®åœ¨éé«˜å³°æœŸä¿®æ”¹ï¼Œå¹¶æå‰é€šçŸ¥ç”¨æˆ·                           â”‚
â”‚ â€¢ ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡                                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä½¿ç”¨æµç¨‹

### ç®¡ç†å‘˜é…ç½®æµç¨‹

1. **ç™»å½•ç®¡ç†åå°**
   ```
   ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•ç³»ç»Ÿ
   ```

2. **è¿›å…¥è®¾ç½®é¡µé¢**
   ```
   ç‚¹å‡»"ç®¡ç†" â†’ "AI å†™ä½œè®¾ç½®"æ ‡ç­¾é¡µ
   ```

3. **æŸ¥çœ‹å½“å‰è®¾ç½®**
   ```
   ç³»ç»Ÿè‡ªåŠ¨åŠ è½½å½“å‰é…ç½®çš„å‚æ•°
   ```

4. **ä¿®æ”¹å‚æ•°**
   ```
   â€¢ è°ƒæ•´ Token æ•°é‡ï¼ˆå®æ—¶é¢„è§ˆæ•ˆæœï¼‰
   â€¢ è°ƒæ•´åˆ›æ„åº¦ï¼ˆæ»‘åŠ¨æ¡ï¼‰
   â€¢ è®¾ç½®é»˜è®¤å­—æ•°
   â€¢ å¯ç”¨/ç¦ç”¨åŠŸèƒ½
   ```

5. **ä¿å­˜è®¾ç½®**
   ```
   ç‚¹å‡»"ä¿å­˜è®¾ç½®"æŒ‰é’®
   ç³»ç»ŸéªŒè¯å‚æ•° â†’ æ›´æ–°æ•°æ®åº“ â†’ æ˜¾ç¤ºæˆåŠŸæç¤º
   ```

6. **å³æ—¶ç”Ÿæ•ˆ**
   ```
   ç”¨æˆ·ä¸‹æ¬¡ç”Ÿæˆå†…å®¹æ—¶è‡ªåŠ¨ä½¿ç”¨æ–°å‚æ•°
   æ— éœ€é‡å¯æœåŠ¡æˆ–é‡æ–°ç™»å½•
   ```

---

### å‚æ•°è°ƒä¼˜å»ºè®®

#### åœºæ™¯ 1ï¼šç”ŸæˆçŸ­æ–‡å†…å®¹
```
ç›®æ ‡ï¼š500-1000 å­—çš„ç®€ä»‹å’Œæ¦‚è¿°

æ¨èé…ç½®ï¼š
â€¢ Token æ•°é‡ï¼š2048-4096
â€¢ åˆ›æ„åº¦ï¼š0.5-0.7
â€¢ é»˜è®¤å­—æ•°ï¼š800

æ•ˆæœï¼šç”Ÿæˆé€Ÿåº¦å¿«ï¼Œå†…å®¹ç®€æ´
```

#### åœºæ™¯ 2ï¼šç”Ÿæˆæ ‡å‡†æ–‡ç« 
```
ç›®æ ‡ï¼š1000-2000 å­—çš„å®Œæ•´æ–‡ç« 

æ¨èé…ç½®ï¼š
â€¢ Token æ•°é‡ï¼š4096-6144
â€¢ åˆ›æ„åº¦ï¼š0.7
â€¢ é»˜è®¤å­—æ•°ï¼š1500

æ•ˆæœï¼šå¹³è¡¡é€Ÿåº¦ä¸è´¨é‡
```

#### åœºæ™¯ 3ï¼šç”Ÿæˆæ·±åº¦å†…å®¹
```
ç›®æ ‡ï¼š2000-3000 å­—çš„æ·±åº¦åˆ†æ

æ¨èé…ç½®ï¼š
â€¢ Token æ•°é‡ï¼š8192
â€¢ åˆ›æ„åº¦ï¼š0.7-0.8
â€¢ é»˜è®¤å­—æ•°ï¼š2500

æ•ˆæœï¼šå†…å®¹è¯¦å®ï¼Œæ¡ˆä¾‹ä¸°å¯Œ
```

#### åœºæ™¯ 4ï¼šåˆ›æ„å†™ä½œ
```
ç›®æ ‡ï¼šè¥é”€æ–‡æ¡ˆã€åˆ›æ„å†…å®¹

æ¨èé…ç½®ï¼š
â€¢ Token æ•°é‡ï¼š6144-8192
â€¢ åˆ›æ„åº¦ï¼š0.8-1.0
â€¢ é»˜è®¤å­—æ•°ï¼š1500

æ•ˆæœï¼šå¯Œæœ‰å˜åŒ–ï¼Œæ›´æœ‰åˆ›æ„
```

---

## ç›‘æ§ä¸ç»´æŠ¤

### æ€§èƒ½ç›‘æ§

**ç›‘æ§æŒ‡æ ‡**ï¼š
- âœ… API è°ƒç”¨æˆåŠŸç‡
- âœ… å¹³å‡ç”Ÿæˆæ—¶é—´
- âœ… Token æ¶ˆè€—é‡
- âœ… ç”¨æˆ·ä½¿ç”¨é¢‘ç‡

**æ—¥å¿—è®°å½•**ï¼š
```typescript
console.log(`Generating content: target=${targetWords} words, estimated tokens=${estimatedTokens}, max tokens=${maxTokens}, system max=${systemMaxTokens}`);
```

### æ•…éšœå¤„ç†

#### é—®é¢˜ 1ï¼šç”Ÿæˆå†…å®¹è¿‡çŸ­
**åŸå› **ï¼šToken é™åˆ¶è¿‡å°  
**è§£å†³**ï¼šæé«˜ `ai_max_output_tokens` å€¼

#### é—®é¢˜ 2ï¼šç”Ÿæˆé€Ÿåº¦è¿‡æ…¢
**åŸå› **ï¼šToken æ•°é‡è¿‡å¤§  
**è§£å†³**ï¼šé™ä½ `ai_max_output_tokens` å€¼

#### é—®é¢˜ 3ï¼šå†…å®¹è´¨é‡ä¸ç¨³å®š
**åŸå› **ï¼šåˆ›æ„åº¦è¿‡é«˜  
**è§£å†³**ï¼šé™ä½ `ai_temperature` å€¼

#### é—®é¢˜ 4ï¼šç”¨æˆ·æ— æ³•ä½¿ç”¨
**åŸå› **ï¼šåŠŸèƒ½è¢«ç¦ç”¨  
**è§£å†³**ï¼šå¯ç”¨ `ai_enabled` å¼€å…³

---

## å®‰å…¨æ€§

### æƒé™æ§åˆ¶

âœ… **ä»…ç®¡ç†å‘˜å¯è®¿é—®**
```typescript
function checkAdminRole(c: Context): boolean {
  const user = c.get('user');
  return user && user.role === 'admin';
}
```

âœ… **API çº§åˆ«éªŒè¯**
```typescript
if (!checkAdminRole(c)) {
  return c.json({ error: 'Unauthorized' }, 403);
}
```

### å‚æ•°éªŒè¯

âœ… **å‰ç«¯éªŒè¯**
```javascript
if (tokensNum < 1000 || tokensNum > 8192) {
  showNotification('Token æ•°é‡å¿…é¡»åœ¨ 1000-8192 ä¹‹é—´', 'error');
  return;
}
```

âœ… **åç«¯éªŒè¯**
```typescript
if (existing.setting_type === 'number') {
  const numValue = parseFloat(body.value);
  if (isNaN(numValue)) {
    return c.json({ error: 'Invalid number value' }, 400);
  }
}
```

---

## éƒ¨ç½²æ¸…å•

### æ•°æ®åº“è¿ç§»

```bash
# åº”ç”¨è¿ç§»æ–‡ä»¶
npx wrangler d1 migrations apply review-system-production --local

# ç”Ÿäº§ç¯å¢ƒ
npx wrangler d1 migrations apply review-system-production --remote
```

### ä»£ç éƒ¨ç½²

```bash
# æ„å»ºé¡¹ç›®
npm run build

# éƒ¨ç½²åˆ° Cloudflare Pages
npx wrangler pages deploy dist --project-name review-system
```

### éªŒè¯æ¸…å•

- [ ] æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
- [ ] API è·¯ç”±å“åº”æ­£å¸¸
- [ ] ç®¡ç†åå°æ˜¾ç¤ºè®¾ç½®é¡µé¢
- [ ] å‚æ•°ä¿®æ”¹å¯ä»¥ä¿å­˜
- [ ] AI ç”Ÿæˆä½¿ç”¨æ–°å‚æ•°
- [ ] æƒé™æ§åˆ¶æ­£å¸¸å·¥ä½œ

---

## æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½

1. **æ›´å¤š AI å‚æ•°**
   - Top P å€¼é…ç½®
   - Top K å€¼é…ç½®
   - åœæ­¢åºåˆ—é…ç½®

2. **æ¨¡å‹é€‰æ‹©**
   - æ”¯æŒåˆ‡æ¢ä¸åŒçš„ AI æ¨¡å‹
   - Gemini Pro / Flash åˆ‡æ¢
   - è‡ªå®šä¹‰æ¨¡å‹ API

3. **ä½¿ç”¨ç»Ÿè®¡**
   - Token æ¶ˆè€—ç»Ÿè®¡
   - ç”Ÿæˆæ¬¡æ•°ç»Ÿè®¡
   - æˆæœ¬åˆ†æ

4. **é…ç½®ç‰ˆæœ¬**
   - é…ç½®å†å²è®°å½•
   - å›æ»šåˆ°å†å²ç‰ˆæœ¬
   - é…ç½®å¯¹æ¯”

5. **A/B æµ‹è¯•**
   - ä¸åŒå‚æ•°ç»„å¯¹æ¯”
   - æ•ˆæœè¯„ä¼°
   - è‡ªåŠ¨ä¼˜åŒ–

---

## Git æäº¤è®°å½•

```bash
50ce0a8 - æ·»åŠ  AI å†™ä½œåŠ©æ‰‹ç³»ç»Ÿè®¾ç½®åŠŸèƒ½ - ç®¡ç†åå°å¯é…ç½® maxOutputTokens ç­‰å‚æ•°
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `migrations/0045_create_system_settings.sql` - æ•°æ®åº“è¿ç§»
- `src/routes/system_settings.ts` - ç³»ç»Ÿè®¾ç½® API
- `src/routes/ai_books.ts` - AI ç”Ÿæˆé€»è¾‘æ›´æ–°
- `src/index.tsx` - æ³¨å†Œç³»ç»Ÿè®¾ç½®è·¯ç”±
- `public/static/app.js` - ç®¡ç†åå°UI

---

## æ€»ç»“

### åŠŸèƒ½ç‰¹ç‚¹

âœ… **æ˜“ç”¨æ€§** - å¯è§†åŒ–ç•Œé¢ï¼Œæ— éœ€ç¼–ç¨‹çŸ¥è¯†  
âœ… **å®æ—¶æ€§** - ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯  
âœ… **å®‰å…¨æ€§** - æƒé™æ§åˆ¶ï¼Œå‚æ•°éªŒè¯  
âœ… **çµæ´»æ€§** - æ”¯æŒå¤šç§åœºæ™¯é…ç½®  
âœ… **å¯ç»´æŠ¤** - æ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œå®Œå–„çš„æ–‡æ¡£

### ä¸šåŠ¡ä»·å€¼

ğŸ“ˆ **æå‡ä½“éªŒ** - ç®¡ç†å‘˜å¯æ ¹æ®éœ€æ±‚çµæ´»è°ƒæ•´  
ğŸ’° **æˆæœ¬æ§åˆ¶** - é€šè¿‡ Token é™åˆ¶æ§åˆ¶APIæˆæœ¬  
âš¡ **æ€§èƒ½ä¼˜åŒ–** - æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–å‚æ•°  
ğŸ›¡ï¸ **é£é™©æ§åˆ¶** - å¿«é€Ÿç¦ç”¨åŠŸèƒ½åº”å¯¹æ•…éšœ  
ğŸ“Š **æ•°æ®é©±åŠ¨** - åŸºäºä½¿ç”¨æ•°æ®è°ƒæ•´é…ç½®

---

**åŠŸèƒ½å®Œæˆæ—¥æœŸ**: 2025-11-20  
**å¼€å‘äººå‘˜**: Claude  
**åŠŸèƒ½ç±»å‹**: ç®¡ç†åå°å¢å¼º  
**å½±å“èŒƒå›´**: AI å†™ä½œç³»ç»Ÿå…¨å±€é…ç½®
