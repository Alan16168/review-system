# YouTube è§†é¢‘åˆ†æåŠŸèƒ½å®ç°æŠ¥å‘Š

**å®ç°æ—¶é—´**: 2025-11-24  
**ç‰ˆæœ¬**: v8.5.0  
**åŠŸèƒ½ç±»å‹**: YouTube è§†é¢‘æ™ºèƒ½åˆ†æ

## åŠŸèƒ½æ¦‚è¿°

å®ç°äº†å®Œæ•´çš„ YouTube è§†é¢‘åˆ†æåŠŸèƒ½ï¼Œæ”¯æŒä»è§†é¢‘é“¾æ¥è‡ªåŠ¨æå–ä¿¡æ¯å¹¶è¿›è¡Œ AI åˆ†æã€‚

## æŠ€æœ¯æ¶æ„

### ä¸‰æ­¥ API è°ƒç”¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥ï¼šYouTube è§†é¢‘é“¾æ¥              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 1: æå–è§†é¢‘ ID                     â”‚
â”‚  - æ”¯æŒå¤šç§ URL æ ¼å¼                     â”‚
â”‚  - youtube.com/watch?v=xxx               â”‚
â”‚  - youtu.be/xxx                          â”‚
â”‚  - youtube.com/embed/xxx                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 2: è°ƒç”¨ YouTube Data API v3       â”‚
â”‚  è·å–è§†é¢‘å…ƒæ•°æ®ï¼š                        â”‚
â”‚  âœ“ è§†é¢‘æ ‡é¢˜                              â”‚
â”‚  âœ“ å‘å¸ƒæ—¥æœŸ                              â”‚
â”‚  âœ“ é¢‘é“åç§°                              â”‚
â”‚  âœ“ è§†é¢‘æè¿°                              â”‚
â”‚  âœ“ è§‚çœ‹æ¬¡æ•°ã€ç‚¹èµæ•°                      â”‚
â”‚  âœ“ è§†é¢‘æ—¶é•¿                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 3: è°ƒç”¨ YouTube Transcript API    â”‚
â”‚  æå–è§†é¢‘å­—å¹•ï¼š                          â”‚
â”‚  âœ“ ä¼˜å…ˆæå–ä¸­æ–‡å­—å¹• (zh-Hans)            â”‚
â”‚  âœ“ é™çº§æå–è‹±æ–‡å­—å¹• (en)                 â”‚
â”‚  âœ“ å­—å¹•æ—¶é—´è½´è½¬æ¢ä¸ºçº¯æ–‡æœ¬                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 4: è°ƒç”¨ Gemini AI åˆ†æ             â”‚
â”‚  ç»¼åˆåˆ†æï¼š                              â”‚
â”‚  âœ“ åŸºäºè§†é¢‘å…ƒæ•°æ®                        â”‚
â”‚  âœ“ åŸºäºè§†é¢‘å­—å¹•å†…å®¹                      â”‚
â”‚  âœ“ æ ¹æ®ç”¨æˆ·æç¤ºè¯ç”Ÿæˆåˆ†æ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›ï¼šç»“æ„åŒ–åˆ†æç»“æœ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒä»£ç å®ç°

### 1. è§†é¢‘ ID æå–å‡½æ•°

```typescript
function extractYouTubeVideoId(url: string): string | null {
  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,
    /youtube\.com\/watch\?.*v=([^&\n?#]+)/
  ];
  
  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match && match[1]) {
      return match[1];
    }
  }
  
  return null;
}
```

**æ”¯æŒçš„ URL æ ¼å¼**:
- `https://www.youtube.com/watch?v=dQw4w9WgXcQ`
- `https://youtu.be/dQw4w9WgXcQ`
- `https://www.youtube.com/embed/dQw4w9WgXcQ`
- `https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=10s`

### 2. YouTube è§†é¢‘åˆ†æå‡½æ•°

```typescript
async function analyzeYouTubeVideo(
  videoUrl: string, 
  prompt: string, 
  env: any
): Promise<string> {
  // æ­¥éª¤ 1: æå–è§†é¢‘ ID
  const videoId = extractYouTubeVideoId(videoUrl);
  
  // æ­¥éª¤ 2: è·å–è§†é¢‘å…ƒæ•°æ®
  const metadataResponse = await fetch(
    `https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id=${videoId}&key=${YOUTUBE_API_KEY}`
  );
  
  // æ­¥éª¤ 3: è·å–è§†é¢‘å­—å¹•
  const transcriptResponse = await fetch(
    `https://www.youtube.com/api/timedtext?v=${videoId}&lang=zh-Hans&fmt=json3`
  );
  
  // æ­¥éª¤ 4: AI åˆ†æ
  const geminiResponse = await fetch(
    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${GEMINI_API_KEY}`,
    {
      method: 'POST',
      body: JSON.stringify({
        contents: [{ 
          role: 'user',
          parts: [{ text: fullPrompt }]
        }]
      })
    }
  );
  
  return result;
}
```

## API é…ç½®è¦æ±‚

### 1. YouTube Data API v3

**é…ç½®ä½ç½®**: Cloudflare Pages ç¯å¢ƒå˜é‡
```
YOUTUBE_API_KEY=your-youtube-api-key
```

**è·å–æ–¹å¼**:
1. è®¿é—® [Google Cloud Console](https://console.cloud.google.com/)
2. åˆ›å»ºæˆ–é€‰æ‹©é¡¹ç›®
3. å¯ç”¨ "YouTube Data API v3"
4. åˆ›å»º API å¯†é’¥ï¼ˆå‡­æ®ï¼‰
5. å¤åˆ¶ API å¯†é’¥åˆ°ç¯å¢ƒå˜é‡

**ä½¿ç”¨åœºæ™¯**:
- è·å–è§†é¢‘æ ‡é¢˜ã€æè¿°ã€ç»Ÿè®¡æ•°æ®
- è·å–é¢‘é“ä¿¡æ¯
- è·å–è§†é¢‘æ—¶é•¿

### 2. YouTube Transcript API

**é…ç½®**: æ— éœ€é…ç½®ï¼ˆä½¿ç”¨å…¬å¼€ APIï¼‰

**API ç«¯ç‚¹**:
```
https://www.youtube.com/api/timedtext?v={videoId}&lang={lang}&fmt=json3
```

**æ”¯æŒè¯­è¨€**:
- `zh-Hans`: ç®€ä½“ä¸­æ–‡
- `en`: è‹±æ–‡
- æ›´å¤šè¯­è¨€ä»£ç 

**å“åº”æ ¼å¼**:
```json
{
  "events": [
    {
      "tStartMs": 0,
      "dDurationMs": 3000,
      "segs": [
        { "utf8": "Hello World" }
      ]
    }
  ]
}
```

### 3. Gemini AI API

**é…ç½®ä½ç½®**: Cloudflare Pages ç¯å¢ƒå˜é‡
```
GEMINI_API_KEY=your-gemini-api-key
```

**ä½¿ç”¨æ¨¡å‹**: `gemini-2.0-flash-exp`

**ç‰¹æ€§**:
- æ”¯æŒé•¿æ–‡æœ¬åˆ†æï¼ˆ50,000 å­—ç¬¦é™åˆ¶ï¼‰
- å¿«é€Ÿå“åº”
- æ”¯æŒä¸­è‹±æ–‡

## åŠŸèƒ½ç‰¹æ€§

### âœ… æ™ºèƒ½å­—å¹•æå–

1. **ä¼˜å…ˆä¸­æ–‡**: å…ˆå°è¯•æå–ä¸­æ–‡å­—å¹•
2. **é™çº§è‹±æ–‡**: ä¸­æ–‡ä¸å¯ç”¨æ—¶æå–è‹±æ–‡å­—å¹•
3. **æ ¼å¼è½¬æ¢**: å°†æ—¶é—´è½´å­—å¹•è½¬æ¢ä¸ºè¿ç»­æ–‡æœ¬
4. **å®¹é”™å¤„ç†**: æ— å­—å¹•æ—¶ä»…åŸºäºå…ƒæ•°æ®åˆ†æ

### âœ… å®Œæ•´å…ƒæ•°æ®æ”¯æŒ

æå–çš„è§†é¢‘ä¿¡æ¯åŒ…æ‹¬ï¼š
- ğŸ“ è§†é¢‘æ ‡é¢˜
- ğŸ“… å‘å¸ƒæ—¥æœŸ
- ğŸ‘¤ é¢‘é“åç§°
- ğŸ“„ è§†é¢‘æè¿°
- ğŸ‘ï¸ è§‚çœ‹æ¬¡æ•°
- ğŸ‘ ç‚¹èµæ•°
- â±ï¸ è§†é¢‘æ—¶é•¿

### âœ… çµæ´»çš„é™çº§ç­–ç•¥

```
YouTube Data API å¯ç”¨ âœ“
    â†“
æå–å®Œæ•´å…ƒæ•°æ®
    â†“
YouTube Transcript API (ä¸­æ–‡) âœ“
    â†“
æå–ä¸­æ–‡å­—å¹•
    â†“
Gemini AI åˆ†æ
    â†“
è¿”å›ç»“æœ

å¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼Œè‡ªåŠ¨é™çº§ï¼š
- æ—  YouTube Data API â†’ ä»…ä½¿ç”¨å­—å¹•
- æ— ä¸­æ–‡å­—å¹• â†’ ä½¿ç”¨è‹±æ–‡å­—å¹•
- æ— å­—å¹• â†’ ä»…ä½¿ç”¨å…ƒæ•°æ®
- æ— å…ƒæ•°æ® â†’ æç¤ºç”¨æˆ·é”™è¯¯
```

## ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯è°ƒç”¨

```javascript
// ç”¨æˆ·è¾“å…¥
const videoUrl = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
const prompt = 'è¯·åˆ†æè¿™ä¸ªè§†é¢‘çš„ä¸»è¦å†…å®¹å’Œæ ¸å¿ƒè§‚ç‚¹';

// API è°ƒç”¨
const response = await axios.post('/api/reviews/famous-books/analyze', {
  inputType: 'video',
  content: videoUrl,
  prompt: prompt,
  language: 'zh-CN'
});

// å“åº”
console.log(response.data.result);
// "è¿™ä¸ªè§†é¢‘æ˜¯..."
```

### åç«¯å¤„ç†æµç¨‹

```typescript
// 1. æ£€æµ‹è§†é¢‘ URL
if (inputType === 'video' && (content.includes('youtube.com') || content.includes('youtu.be'))) {
  // 2. è°ƒç”¨è§†é¢‘åˆ†æå‡½æ•°
  const videoAnalysis = await analyzeYouTubeVideo(content, prompt, c.env);
  
  // 3. è¿”å›ç»“æœ
  return c.json({ 
    result: videoAnalysis, 
    source: 'youtube+ai' 
  });
}
```

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ç±»å‹ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| Invalid YouTube URL | URL æ ¼å¼ä¸æ­£ç¡® | æç¤ºç”¨æˆ·è¾“å…¥æ­£ç¡®çš„ YouTube é“¾æ¥ |
| YouTube API quota exceeded | API é…é¢ç”¨å°½ | ä½¿ç”¨ API å¯†é’¥ç®¡ç†é…é¢ |
| Transcript not available | è§†é¢‘æ— å­—å¹• | é™çº§åˆ°ä»…å…ƒæ•°æ®åˆ†æ |
| Gemini API error | API å¯†é’¥æ— æ•ˆæˆ–é™æµ | æ£€æŸ¥ API å¯†é’¥é…ç½® |

### é”™è¯¯å¤„ç†ä»£ç 

```typescript
try {
  const videoAnalysis = await analyzeYouTubeVideo(content, prompt, c.env);
  return c.json({ result: videoAnalysis, source: 'youtube+ai' });
} catch (videoError) {
  console.error('YouTube video analysis failed:', videoError);
  // é™çº§åˆ°æ™®é€š AI åˆ†æ
  return c.json({ 
    result: await fallbackAnalysis(content, prompt),
    source: 'gemini',
    warning: 'æ— æ³•æå–è§†é¢‘è¯¦ç»†ä¿¡æ¯ï¼Œä»…åŸºäº URL è¿›è¡Œåˆ†æ'
  });
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶è¡Œè¯·æ±‚

```typescript
// åŒæ—¶è¯·æ±‚å…ƒæ•°æ®å’Œå­—å¹•
const [metadata, transcript] = await Promise.all([
  fetchYouTubeMetadata(videoId),
  fetchYouTubeTranscript(videoId)
]);
```

### 2. å­—å¹•é•¿åº¦é™åˆ¶

```typescript
// é™åˆ¶å­—å¹•é•¿åº¦ï¼Œé¿å… API è¶…æ—¶
const truncatedTranscript = transcript.substring(0, 50000);
```

### 3. ç¼“å­˜ç­–ç•¥ï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰

- ç¼“å­˜è§†é¢‘å…ƒæ•°æ®ï¼ˆ24å°æ—¶ï¼‰
- ç¼“å­˜å­—å¹•æ•°æ®ï¼ˆ7å¤©ï¼‰
- ç¼“å­˜åˆ†æç»“æœï¼ˆåŸºäºè§†é¢‘ ID + prompt hashï¼‰

## éƒ¨ç½²ä¿¡æ¯

- **æ„å»ºæ—¶é—´**: 2025-11-24 03:15 UTC
- **æ„å»ºå¤§å°**: 387.22 kB (+2.62 kB)
- **éƒ¨ç½² ID**: 4409af23
- **ç”Ÿäº§ URL**: https://review-system.pages.dev
- **éƒ¨ç½² URL**: https://4409af23.review-system.pages.dev

## ç¯å¢ƒå˜é‡é…ç½®

### Cloudflare Pages ç¯å¢ƒå˜é‡

```bash
# YouTube Data API v3
YOUTUBE_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Gemini AI API
GEMINI_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Genspark API (å¯é€‰)
GENSPARK_API_KEY=gsk_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

### é…ç½®æ–¹å¼

1. è®¿é—® Cloudflare Pages é¡¹ç›®è®¾ç½®
2. è¿›å…¥ "Settings" â†’ "Environment variables"
3. æ·»åŠ ä»¥ä¸Šç¯å¢ƒå˜é‡
4. é‡æ–°éƒ¨ç½²é¡¹ç›®

## æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹

```typescript
// æµ‹è¯• 1: æ ‡å‡† YouTube é“¾æ¥
const test1 = await analyzeYouTubeVideo(
  'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
  'è¯·åˆ†æè§†é¢‘å†…å®¹',
  env
);

// æµ‹è¯• 2: çŸ­é“¾æ¥
const test2 = await analyzeYouTubeVideo(
  'https://youtu.be/dQw4w9WgXcQ',
  'è¯·åˆ†æè§†é¢‘å†…å®¹',
  env
);

// æµ‹è¯• 3: å¸¦æ—¶é—´æˆ³çš„é“¾æ¥
const test3 = await analyzeYouTubeVideo(
  'https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=30s',
  'è¯·åˆ†æè§†é¢‘å†…å®¹',
  env
);
```

### é¢„æœŸç»“æœ

```json
{
  "result": "ã€è§†é¢‘åˆ†æã€‘\n\nè¿™ä¸ªè§†é¢‘çš„ä¸»é¢˜æ˜¯...\n\næ ¸å¿ƒè§‚ç‚¹ï¼š\n1. ...\n2. ...\n3. ...",
  "source": "youtube+ai"
}
```

## Git æäº¤

```bash
Commit: 48fefb4
Message: å®ç°å®Œæ•´çš„ YouTube è§†é¢‘åˆ†æåŠŸèƒ½
- æ·»åŠ  YouTube è§†é¢‘ ID æå–å‡½æ•°
- å®ç°ä¸‰æ­¥ API è°ƒç”¨æµç¨‹
- æ”¯æŒä¸­è‹±æ–‡å­—å¹•æå–
- æ”¹è¿›é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥
```

## æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. å¢å¼ºåŠŸèƒ½

- [ ] æ”¯æŒæ‰¹é‡è§†é¢‘åˆ†æ
- [ ] æ”¯æŒè§†é¢‘ç« èŠ‚åˆ†æ®µåˆ†æ
- [ ] æ”¯æŒå¤šè¯­è¨€å­—å¹•é€‰æ‹©
- [ ] æ·»åŠ è§†é¢‘æ‘˜è¦åŠŸèƒ½

### 2. æ€§èƒ½ä¼˜åŒ–

- [ ] å®ç°ç»“æœç¼“å­˜
- [ ] å¹¶è¡Œ API è°ƒç”¨
- [ ] æµå¼è¿”å›åˆ†æç»“æœ

### 3. ç”¨æˆ·ä½“éªŒ

- [ ] æ˜¾ç¤ºåˆ†æè¿›åº¦
- [ ] æ”¯æŒå–æ¶ˆåˆ†æ
- [ ] æä¾›åˆ†æå†å²è®°å½•

## æ€»ç»“

é€šè¿‡å®ç°å®Œæ•´çš„ YouTube è§†é¢‘åˆ†æåŠŸèƒ½ï¼š

âœ… **ä¸‰æ­¥ API è°ƒç”¨æµç¨‹** - YouTube Data API â†’ Transcript API â†’ Gemini AI  
âœ… **æ™ºèƒ½é™çº§ç­–ç•¥** - ç¡®ä¿åœ¨å„ç§æƒ…å†µä¸‹éƒ½èƒ½æä¾›åˆ†æ  
âœ… **å®Œæ•´é”™è¯¯å¤„ç†** - æ•è·å¹¶å¤„ç†æ‰€æœ‰å¯èƒ½çš„é”™è¯¯  
âœ… **çµæ´»çš„é…ç½®** - æ”¯æŒå¤šä¸ª AI æœåŠ¡å•†  

åŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼ğŸ‰
