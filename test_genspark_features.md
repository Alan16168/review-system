# Genspark Integration & Edit Feature Testing Guide

## ğŸ¯ æµ‹è¯•ç›®æ ‡

1. âœ… éªŒè¯ Genspark API é›†æˆï¼ˆå¸¦é™çº§æœºåˆ¶ï¼‰
2. âœ… æµ‹è¯•ç¼–è¾‘åŠŸèƒ½
3. âœ… éªŒè¯ç”¨æˆ·æ•°æ®éš”ç¦»
4. âœ… æµ‹è¯•å®Œæ•´çš„å·¥ä½œæµç¨‹

---

## ğŸ“ å‰ç½®æ¡ä»¶

### å·²å®Œæˆé…ç½®ï¼š
- âœ… Gemini API Key: å·²é…ç½®
- âœ… YouTube API Key: å·²é…ç½®
- âš ï¸ Genspark API Key: éœ€è¦é…ç½®ï¼ˆå½“å‰ä½¿ç”¨é™çº§æ–¹æ¡ˆï¼‰

### æµ‹è¯•è´¦å·ï¼š
- **Admin**: admin@example.com (subscription_tier: super)
- **Premium User**: premium@example.com (subscription_tier: premium)
- **Free User**: user@example.com (subscription_tier: free)

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯• 1: è®¿é—®æƒé™éªŒè¯

**ç›®æ ‡**: éªŒè¯åªæœ‰ Premium å’Œ Admin ç”¨æˆ·å¯ä»¥è®¿é—®åè‘—å¤ç›˜åŠŸèƒ½

**æ­¥éª¤**:
1. ä½¿ç”¨ Free User ç™»å½•
2. å°è¯•è®¿é—®"åè‘—å¤ç›˜"æ ‡ç­¾
3. **æœŸæœ›ç»“æœ**: æ˜¾ç¤º"Premium subscription required"æˆ–æƒé™ä¸è¶³æç¤º

4. ä½¿ç”¨ Premium User ç™»å½•
5. è®¿é—®"åè‘—å¤ç›˜"æ ‡ç­¾
6. **æœŸæœ›ç»“æœ**: å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œæ˜¾ç¤ºåˆ—è¡¨æˆ–åˆ›å»ºè¡¨å•

---

### æµ‹è¯• 2: åˆ›å»ºåè‘—å¤ç›˜ï¼ˆè§†é¢‘åˆ†æï¼‰

**ç›®æ ‡**: æµ‹è¯•å®Œæ•´çš„è§†é¢‘åˆ†ææµç¨‹ï¼ˆGenspark â†’ Gemini é™çº§ï¼‰

**æ­¥éª¤**:
1. ä½¿ç”¨ Premium/Admin è´¦å·ç™»å½•
2. ç‚¹å‡»"åè‘—å¤ç›˜"æ ‡ç­¾
3. ç‚¹å‡»"æ–°å¢å¤ç›˜"æŒ‰é’®
4. é€‰æ‹©"è§†é¢‘é“¾æ¥"
5. è¾“å…¥æµ‹è¯• YouTube URL:
   ```
   https://www.youtube.com/watch?v=xNp-90JImAU
   ```
6. å¡«å†™è¡¨å•:
   - æ€»å­—æ•°è¦æ±‚: 3000
   - åº”ç”¨åœºæ™¯: èŒåœº
   - è¾“å‡ºè¯­è¨€: ç®€ä½“ä¸­æ–‡
7. ç‚¹å‡»"ç”Ÿæˆ Prompt"
8. æŸ¥çœ‹å¹¶ç¼–è¾‘æç¤ºè¯ï¼ˆå¯é€‰ï¼‰
9. ç‚¹å‡»"ç”Ÿæˆåˆ†æ"
10. **æœŸæœ›ç»“æœ**:
    - æ˜¾ç¤ºåŠ è½½çŠ¶æ€: "Using Genspark API for video analysis..."
    - å¦‚æœ Genspark API Key æœªé…ç½®ï¼Œè‡ªåŠ¨é™çº§åˆ° Gemini
    - æ˜¾ç¤ºåˆ†æç»“æœï¼ˆTinyMCE ç¼–è¾‘å™¨ï¼‰
    - å†…å®¹åŒ…å«è§†é¢‘å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€æè¿°ã€æ ‡ç­¾ï¼‰

---

### æµ‹è¯• 3: ç¼–è¾‘åŠŸèƒ½

**ç›®æ ‡**: æµ‹è¯•ç¼–è¾‘å·²æœ‰è®°å½•çš„åŠŸèƒ½

**å‰ç½®æ¡ä»¶**: å·²åˆ›å»ºè‡³å°‘ä¸€æ¡åè‘—å¤ç›˜è®°å½•

**æ­¥éª¤**:
1. åœ¨åè‘—å¤ç›˜åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€æ¡è®°å½•
2. ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ï¼ˆé“…ç¬”å›¾æ ‡ï¼‰
3. **æœŸæœ›ç»“æœ**:
   - æ˜¾ç¤ºç¼–è¾‘é¡µé¢
   - æ ‡é¢˜è¾“å…¥æ¡†å¡«å……äº†åŸæ ‡é¢˜
   - TinyMCE ç¼–è¾‘å™¨æ˜¾ç¤ºåŸå†…å®¹
4. ä¿®æ”¹æ ‡é¢˜ä¸º: "æµ‹è¯•ç¼–è¾‘ - [åŸæ ‡é¢˜]"
5. ä¿®æ”¹å†…å®¹ï¼ˆæ·»åŠ ä¸€æ®µæ–‡å­—ï¼‰
6. ç‚¹å‡»"ä¿å­˜ä¿®æ”¹"
7. **æœŸæœ›ç»“æœ**:
   - æ˜¾ç¤º"æ“ä½œæˆåŠŸ"æç¤º
   - è¿”å›åˆ—è¡¨é¡µ
   - åˆ—è¡¨ä¸­æ˜¾ç¤ºæ›´æ–°åçš„æ ‡é¢˜
   - updated_at æ—¶é—´å·²æ›´æ–°

---

### æµ‹è¯• 4: ç”¨æˆ·æ•°æ®éš”ç¦»

**ç›®æ ‡**: éªŒè¯æ¯ä¸ªç”¨æˆ·åªèƒ½çœ‹åˆ°å’Œç¼–è¾‘è‡ªå·±çš„è®°å½•

**æ­¥éª¤**:
1. ä½¿ç”¨ç”¨æˆ· A (Admin) åˆ›å»ºä¸€æ¡å¤ç›˜è®°å½•
2. è®°å½•æ ‡é¢˜: "Adminçš„æµ‹è¯•è®°å½•"
3. ä¿å­˜æˆåŠŸ

4. ä½¿ç”¨ç”¨æˆ· B (Premium User) ç™»å½•
5. è®¿é—®"åè‘—å¤ç›˜"åˆ—è¡¨
6. **æœŸæœ›ç»“æœ**: çœ‹ä¸åˆ°"Adminçš„æµ‹è¯•è®°å½•"

7. ä½¿ç”¨ç”¨æˆ· B åˆ›å»ºè‡ªå·±çš„è®°å½•
8. è®°å½•æ ‡é¢˜: "Premium Userçš„æµ‹è¯•è®°å½•"
9. ä¿å­˜æˆåŠŸ
10. **æœŸæœ›ç»“æœ**: åªèƒ½çœ‹åˆ°è‡ªå·±çš„è®°å½•

11. å°è¯•ç›´æ¥è®¿é—®ç”¨æˆ· A çš„è®°å½• ID (å¦‚æœçŸ¥é“)
12. **æœŸæœ›ç»“æœ**: 403 Forbidden æˆ–çœ‹ä¸åˆ°ç¼–è¾‘æŒ‰é’®

---

### æµ‹è¯• 5: æŸ¥çœ‹åŠŸèƒ½

**ç›®æ ‡**: æµ‹è¯•æŸ¥çœ‹å¤ç›˜è¯¦æƒ…

**æ­¥éª¤**:
1. åœ¨åˆ—è¡¨ä¸­ç‚¹å‡»"æŸ¥çœ‹"æŒ‰é’®ï¼ˆçœ¼ç›å›¾æ ‡ï¼‰
2. **æœŸæœ›ç»“æœ**:
   - æ˜¾ç¤ºè®°å½•è¯¦æƒ…é¡µ
   - æ ‡é¢˜å’Œå†…å®¹æ­£ç¡®æ˜¾ç¤º
   - æœ‰"è¿”å›åˆ—è¡¨"æŒ‰é’®
3. ç‚¹å‡»"è¿”å›åˆ—è¡¨"
4. **æœŸæœ›ç»“æœ**: è¿”å›åˆ—è¡¨é¡µ

---

### æµ‹è¯• 6: ä¸‹è½½åŠŸèƒ½

**ç›®æ ‡**: æµ‹è¯•ä¸‹è½½ä¸º TXT æ–‡ä»¶

**æ­¥éª¤**:
1. åœ¨åˆ—è¡¨ä¸­ç‚¹å‡»"ä¸‹è½½"æŒ‰é’®ï¼ˆä¸‹è½½å›¾æ ‡ï¼‰
2. **æœŸæœ›ç»“æœ**:
   - æµè§ˆå™¨å¼€å§‹ä¸‹è½½ TXT æ–‡ä»¶
   - æ–‡ä»¶åæ ¼å¼: `[æ ‡é¢˜].txt`
   - æ–‡ä»¶å†…å®¹åŒ…å«æ ‡é¢˜å’Œå†…å®¹

---

### æµ‹è¯• 7: åˆ é™¤åŠŸèƒ½

**ç›®æ ‡**: æµ‹è¯•åˆ é™¤å¤ç›˜è®°å½•

**æ­¥éª¤**:
1. åˆ›å»ºä¸€æ¡æµ‹è¯•è®°å½•ï¼ˆæ ‡é¢˜: "å¾…åˆ é™¤çš„æµ‹è¯•è®°å½•"ï¼‰
2. åœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°è¿™æ¡è®°å½•
3. ç‚¹å‡»"åˆ é™¤"æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰
4. **æœŸæœ›ç»“æœ**: æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
5. ç‚¹å‡»"ç¡®è®¤"
6. **æœŸæœ›ç»“æœ**:
   - æ˜¾ç¤º"åˆ é™¤æˆåŠŸ"æç¤º
   - è®°å½•ä»åˆ—è¡¨ä¸­æ¶ˆå¤±
   - æ•°æ®åº“ä¸­å·²åˆ é™¤

---

### æµ‹è¯• 8: Genspark API é™çº§æœºåˆ¶

**ç›®æ ‡**: éªŒè¯å½“ Genspark ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§åˆ° Gemini

**æ­¥éª¤**:
1. ç¡®è®¤ `.dev.vars` ä¸­ `GENSPARK_API_KEY=your-genspark-api-key-here`ï¼ˆæ— æ•ˆï¼‰
2. åˆ›å»ºæ–°çš„è§†é¢‘åˆ†æ
3. ç‚¹å‡»"ç”Ÿæˆåˆ†æ"
4. **æœŸæœ›ç»“æœ**:
   - æ§åˆ¶å°æ—¥å¿—æ˜¾ç¤º: "Genspark API key not configured, falling back to Gemini"
   - æˆ–: "Genspark API failed, falling back to Gemini"
   - ä»ç„¶æˆåŠŸç”Ÿæˆåˆ†æç»“æœï¼ˆä½¿ç”¨ Geminiï¼‰
   - å“åº” JSON åŒ…å«: `"source": "gemini"`

---

## ğŸ”§ é…ç½® Genspark API Key

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

ç¼–è¾‘ `/home/user/webapp/.dev.vars`:

```bash
# Genspark API Keyï¼ˆç”¨äºè§†é¢‘åˆ†æåŠŸèƒ½ï¼‰
# è·å–æ–¹å¼ï¼šhttps://www.genspark.ai/developer/api-keys
GENSPARK_API_KEY=your-actual-genspark-api-key
```

ä¿å­˜åé‡å¯æœåŠ¡:
```bash
cd /home/user/webapp
fuser -k 3000/tcp || true
pm2 restart review-system
```

### ç”Ÿäº§ç¯å¢ƒ (Cloudflare Pages)

1. ç™»å½• Cloudflare Dashboard
2. é€‰æ‹© Pages é¡¹ç›®: `review-system`
3. è¿›å…¥ Settings â†’ Environment variables
4. æ·»åŠ å˜é‡:
   - **Variable name**: `GENSPARK_API_KEY`
   - **Value**: `your-actual-genspark-api-key`
   - **Environment**: Production (æˆ– Production and Preview)
5. ç‚¹å‡» Save
6. é‡æ–°éƒ¨ç½²é¡¹ç›®

---

## ğŸ“Š æµ‹è¯•ç»“æœè®°å½•

### æµ‹è¯•æ‰§è¡Œæ¸…å•

- [ ] æµ‹è¯• 1: è®¿é—®æƒé™éªŒè¯
- [ ] æµ‹è¯• 2: åˆ›å»ºåè‘—å¤ç›˜ï¼ˆè§†é¢‘åˆ†æï¼‰
- [ ] æµ‹è¯• 3: ç¼–è¾‘åŠŸèƒ½
- [ ] æµ‹è¯• 4: ç”¨æˆ·æ•°æ®éš”ç¦»
- [ ] æµ‹è¯• 5: æŸ¥çœ‹åŠŸèƒ½
- [ ] æµ‹è¯• 6: ä¸‹è½½åŠŸèƒ½
- [ ] æµ‹è¯• 7: åˆ é™¤åŠŸèƒ½
- [ ] æµ‹è¯• 8: Genspark API é™çº§æœºåˆ¶

### å‘ç°çš„é—®é¢˜

è®°å½•æµ‹è¯•ä¸­å‘ç°çš„ä»»ä½•é—®é¢˜ï¼š

1. 
2. 
3. 

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

### æŸ¥çœ‹æœ¬åœ°æ•°æ®åº“ä¸­çš„å¤ç›˜è®°å½•

```bash
cd /home/user/webapp
npx wrangler d1 execute review-system-production --local --command="SELECT id, title, user_id, review_type, status, created_at FROM reviews WHERE review_type='famous-book' ORDER BY created_at DESC LIMIT 10"
```

### æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯

```bash
npx wrangler d1 execute review-system-production --local --command="SELECT id, username, email, role, subscription_tier FROM users"
```

### æ¸…ç©ºæµ‹è¯•æ•°æ®

```bash
npx wrangler d1 execute review-system-production --local --command="DELETE FROM reviews WHERE review_type='famous-book'"
```

### æ£€æŸ¥ PM2 æœåŠ¡çŠ¶æ€

```bash
pm2 list
pm2 logs review-system --nostream
```

### æµ‹è¯• API ç«¯ç‚¹ï¼ˆéœ€è¦æœ‰æ•ˆçš„ JWT tokenï¼‰

```bash
# è·å–åˆ—è¡¨
curl http://localhost:3000/api/reviews/famous-books \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# åˆ›å»ºåˆ†æè¯·æ±‚
curl -X POST http://localhost:3000/api/reviews/famous-books/analyze \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "inputType": "video",
    "content": "https://www.youtube.com/watch?v=xNp-90JImAU",
    "prompt": "åˆ†æè¿™ä¸ªè§†é¢‘...",
    "language": "zh-CN",
    "useGenspark": true
  }'
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ PM2 æ—¥å¿—: `pm2 logs review-system --nostream`
2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å° (F12)
3. æ£€æŸ¥ç½‘ç»œè¯·æ±‚ (F12 â†’ Network)
4. éªŒè¯ç¯å¢ƒå˜é‡é…ç½®

---

## âœ¨ æœŸæœ›çš„ Genspark è¾“å‡ºæ ¼å¼

å½“ Genspark API æ­£å¸¸å·¥ä½œæ—¶ï¼Œåº”è¯¥è¾“å‡ºç±»ä¼¼ä½ æˆªå›¾ä¸­çš„ç»“æ„åŒ–åˆ†æï¼š

```markdown
# Review of Systems

## 1. The Core Proposition
[è¯¦ç»†æè¿°æ ¸å¿ƒä¸»å¼ ]

## 2. The Thinking Framework
### The Perception (Patient Side)
- [æ‚£è€…çš„æ„Ÿå—å’Œä½“éªŒ]

### The Reality (Clinical Necessity)
- [ä¸´åºŠå¿…è¦æ€§çš„ç°å®]

## 3. Key Insights
- [å…³é”®æ´å¯Ÿ 1]
- [å…³é”®æ´å¯Ÿ 2]
- [å…³é”®æ´å¯Ÿ 3]

## 4. Application Recommendations
[é’ˆå¯¹é€‰å®šåœºæ™¯çš„åº”ç”¨å»ºè®®]
```

---

**æµ‹è¯•ç‰ˆæœ¬**: v8.4.0  
**æµ‹è¯•æ—¥æœŸ**: 2025-01-23  
**æµ‹è¯•ç¯å¢ƒ**: Local Development + Cloudflare Pages  
**çŠ¶æ€**: âœ… Ready for Testing
