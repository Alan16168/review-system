# V4.3.0 复盘主人属性和访问控制功能说明

## 📋 功能概述

V4.3.0 版本为复盘系统引入了全新的**主人属性**和**访问控制**机制，让用户可以更灵活地控制复盘的可见性和协作范围。

### 新增功能
1. **复盘主人属性** - 三种访问控制级别
2. **公开的复盘页面** - 展示所有公开复盘
3. **创建/编辑表单增强** - 主人选择器
4. **智能权限控制** - 基于主人属性的访问控制

---

## 🎯 三种主人属性详解

### 1. 私有 (Private)
**特点**：最高隐私保护
- ✅ **仅创建者**可以查看和编辑
- ❌ 团队成员**不可见**
- ❌ 其他用户**不可见**

**使用场景**：
- 个人日记式复盘
- 敏感信息的复盘
- 未完成不想分享的草稿

**示例**：
```
主人：私有
群体类型：个人
结果：只有你能看到和编辑
```

---

### 2. 团队 (Team)
**特点**：团队内部共享
- ✅ **团队成员**可以查看
- ✅ 当**群体类型="团队"**时，团队成员可以协作编辑（每人填写自己的答案）
- ✅ 当**群体类型="个人"**时，团队成员只能查看，不能编辑
- ❌ 非团队成员**不可见**

**访问规则矩阵**：

| 主人属性 | 群体类型 | 团队成员权限 | 非团队成员权限 |
|---------|---------|------------|---------------|
| 团队 | 个人 | 仅查看 | 无权限 |
| 团队 | 项目 | 仅查看 | 无权限 |
| 团队 | 团队 | 可协作编辑 | 无权限 |

**使用场景**：

**场景A - 团队+个人**：团队复盘模板，成员只读
```
主人：团队
群体类型：个人
结果：团队成员可以查看学习，但不能修改
用例：团队leader分享个人复盘作为示例
```

**场景B - 团队+团队**：团队协作复盘
```
主人：团队
群体类型：团队
结果：团队成员可以各自填写答案，相互查看
用例：团队项目复盘，每人贡献自己的观点
```

---

### 3. 公开 (Public)
**特点**：全平台可见
- ✅ **所有用户**都可以查看
- ✅ 在"公开的复盘"菜单中展示
- ❌ **仅创建者**可以编辑
- ❌ 其他用户**只读访问**

**使用场景**：
- 优秀复盘案例分享
- 公开知识贡献
- 教学示例展示

**示例**：
```
主人：公开
群体类型：任意
结果：所有人可以查看和学习，但不能修改
用例：分享一个成功项目的复盘，供全公司学习
```

---

## 🔐 权限控制逻辑

### 查看权限
```
私有：仅创建者
团队：创建者 + 团队成员
公开：所有用户
```

### 编辑权限
```
私有：仅创建者
团队（群体类型=个人/项目）：仅创建者
团队（群体类型=团队）：创建者 + 团队成员（各自编辑自己的答案）
公开：仅创建者
```

### 协作权限（团队答案）
```
仅当：主人=团队 AND 群体类型=团队
才能：团队成员贡献各自的答案
```

---

## 🖥️ 用户界面

### 1. 创建复盘时选择主人
在创建复盘表单中，新增"主人"选择器：

```
┌─────────────────────────────────────┐
│ 主人 *                              │
│ ┌─────────────────────────────────┐ │
│ │ ▼ 私有                          │ │
│ │   团队                          │ │
│ │   公开                          │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 💡 主人属性说明                     │
│ • 私有：仅创建者可见和编辑           │
│ • 团队：团队成员可见；群体类型为     │
│   "团队"时成员可协作                │
│ • 公开：所有人可见但不可编辑         │
│   （仅创建者可编辑）                 │
└─────────────────────────────────────┘
```

### 2. 编辑复盘时修改主人
在编辑表单中，可以修改主人属性：
- 从"私有"改为"团队"或"公开"
- 从"团队"改为"私有"或"公开"
- 从"公开"改为"私有"或"团队"

### 3. 公开的复盘页面
主菜单新增选项：

```
仪表板  |  我的复盘  |  🌐 公开的复盘  |  团队  |  管理后台
```

点击"公开的复盘"后，显示所有主人属性为"公开"的复盘列表：

```
┌──────────────────────────────────────────────────────┐
│ 🌐 公开的复盘                                         │
│ 查看所有公开的复盘，供学习和参考                       │
├──────────────────────────────────────────────────────┤
│ 标题         │ 创建者  │ 状态    │ 更新时间  │ 操作   │
├──────────────┼─────────┼─────────┼───────────┼────────┤
│ 成功项目复盘  │ 张三    │ 已完成  │ 2天前     │ 👁️ 查看│
│ Q1季度总结   │ 李四    │ 已完成  │ 1周前     │ 👁️ 查看│
│ 新产品上线   │ 王五    │ 草稿    │ 3天前     │ 👁️ 查看│
└──────────────┴─────────┴─────────┴───────────┴────────┘
```

---

## 💡 使用建议

### 推荐配置

**个人日常复盘**：
```
主人：私有
群体类型：个人
时间类型：日/周/月复盘
```

**团队项目复盘（仅供团队内查看）**：
```
主人：团队
群体类型：个人
时间类型：项目复盘
适用：团队leader总结项目经验
```

**团队协作复盘（每人贡献观点）**：
```
主人：团队
群体类型：团队
时间类型：项目/月/季复盘
适用：团队共同复盘项目或阶段性工作
```

**优秀案例分享**：
```
主人：公开
群体类型：任意
时间类型：任意
适用：分享给全公司学习的优秀案例
```

---

## 🔄 迁移和兼容性

### 历史数据处理
所有现有复盘自动设置为：
- 有团队的复盘 → `主人=团队`
- 个人复盘 → `主人=私有`

### 向后兼容
- 旧版本创建的复盘自动标记为"私有"
- 所有现有功能保持不变
- 无需手动更新历史数据

---

## 📊 数据模型

### 数据库字段
```sql
ALTER TABLE reviews ADD COLUMN owner_type TEXT DEFAULT 'private';
CREATE INDEX idx_reviews_owner_type ON reviews(owner_type);
```

### 字段值
- `'private'` - 私有
- `'team'` - 团队
- `'public'` - 公开

---

## 🌐 国际化

### 中文翻译
- 主人 (ownerType)
- 私有 (ownerTypePrivate)
- 团队 (ownerTypeTeam)
- 公开 (ownerTypePublic)
- 公开的复盘 (publicReviews)

### 英文翻译
- Owner (ownerType)
- Private (ownerTypePrivate)
- Team (ownerTypeTeam)
- Public (ownerTypePublic)
- Public Reviews (publicReviews)

---

## 🎉 总结

V4.3.0 版本通过引入**主人属性**，为复盘系统带来了：

1. ✅ **更灵活的隐私控制** - 三级访问权限
2. ✅ **更明确的协作范围** - 团队内/全平台共享
3. ✅ **更丰富的分享方式** - 私密/团队/公开
4. ✅ **更好的学习机会** - 公开复盘供所有人学习

这一功能让每个复盘都能找到最合适的可见范围，既保护隐私，又促进知识分享！

---

**版本**: V4.3.0  
**发布日期**: 2025-10-16  
**部署URL**: https://dd13dfdd.review-system.pages.dev
