# V9.3.0 功能测试指南 - 编辑与查看模式权限分离

## 版本信息
- **版本号**: V9.3.0
- **发布日期**: 2025-11-27
- **核心功能**: 编辑模式只显示自己的答案组，查看模式显示所有成员答案

## 测试环境
- **开发环境**: https://3000-i1l7k2pbfdion8sxilbu1-6532622b.e2b.dev
- **生产环境**: https://review-system.pages.dev
- **部署ID**: https://83ac821d.review-system.pages.dev
- **GitHub**: https://github.com/Alan16168/review-system (Commit: d4ff345)

---

## 🎯 核心功能对比

### 功能变化表

| 场景 | V9.2.1 (之前) | V9.3.0 (现在) |
|------|---------------|---------------|
| **编辑模式 - 看到的答案组** | ✅ 所有成员的答案组 | ✅ 只有自己的答案组 |
| **编辑模式 - 可编辑范围** | ⚠️ 只能编辑自己的 | ✅ 只能编辑自己的 |
| **编辑模式 - 查看他人答案** | ✅ 可以查看 | ❌ 无法查看 |
| **查看模式 - 看到的答案** | ✅ 所有成员答案 | ✅ 所有成员答案 |
| **查看模式 - 可编辑性** | ❌ 只读 | ❌ 只读 |

### 设计理念

**V9.2.1的问题**:
- 编辑时能看到其他成员的答案组，容易分散注意力
- 导航时需要区分"自己的"和"他人的"，增加认知负担
- 可能误以为可以编辑他人答案，尝试后才发现不可以

**V9.3.0的改进**:
- ✅ 编辑时完全隔离，只专注自己的内容
- ✅ 界面更清爽，无需区分所有权
- ✅ 所有可见的答案组都是可编辑的
- ✅ 查看时专门的页面显示所有成员答案

---

## 测试场景 1: 编辑模式 - 只显示自己的答案组 ✅

### 1.1 创建并编辑自己的答案组
**操作步骤**:
1. 使用账号A (admin@review.com / admin123) 登录
2. 创建或打开一个团队复盘
3. 点击"编辑"按钮进入编辑模式
4. 创建自己的答案组并填写答案
5. 观察答案组导航区域

**预期结果**:
- ✅ 只能看到自己创建的答案组
- ✅ 答案组导航显示"答案组 1/1"（如果只有1个自己的答案组）
- ✅ 导航区不显示其他成员的答案组数量
- ✅ 所有可见的答案组都可以编辑
- ✅ 锁定/解锁按钮始终可用（因为都是自己的）

### 1.2 多个答案组的导航
**操作步骤**:
1. 继续使用账号A
2. 创建第二个答案组（如果允许多答案）
3. 使用"上一组"/"下一组"按钮导航

**预期结果**:
- ✅ 只在自己的答案组之间切换
- ✅ 答案组导航显示"答案组 1/2"、"答案组 2/2"
- ✅ 看不到其他成员的答案组
- ✅ 所有答案组都显示"(You)"标记

### 1.3 其他成员同样隔离
**操作步骤**:
1. 登出账号A
2. 使用账号B (premium@review.com / premium123) 登录
3. 打开同一个团队复盘
4. 点击"编辑"按钮进入编辑模式
5. 创建自己的答案组

**预期结果**:
- ✅ 账号B只能看到自己创建的答案组
- ✅ 看不到账号A创建的任何答案组
- ✅ 答案组导航从"答案组 1/1"开始（如果是第一个）
- ✅ 完全独立的编辑环境

---

## 测试场景 2: 查看模式 - 显示所有成员答案 ✅

### 2.1 通过团队协作查看页面
**操作步骤**:
1. 使用任意账号登录
2. 在复盘列表中找到团队复盘
3. 点击"查看"按钮（或点击复盘标题）
4. 系统自动跳转到团队协作查看页面

**预期结果**:
- ✅ 页面标题显示团队图标和复盘标题
- ✅ 显示所有成员的完成状态统计
- ✅ 每个问题下显示所有成员的答案
- ✅ 答案按用户分组，每个用户的答案单独显示
- ✅ 可以看到账号A和账号B的所有答案
- ✅ 所有答案为只读，无法编辑

### 2.2 查看不同用户的答案
**操作步骤**:
1. 在团队协作查看页面
2. 滚动查看不同问题的答案
3. 观察不同用户的答案分组

**预期结果**:
- ✅ 每个用户的答案有明确标识（用户名）
- ✅ 当前用户的答案标记"(我)"
- ✅ 可以展开/收起每个用户的多个答案
- ✅ 显示答案创建时间
- ✅ 最新答案标记"最新"徽章

### 2.3 查看模式无法编辑
**操作步骤**:
1. 在团队协作查看页面
2. 尝试点击任何答案内容

**预期结果**:
- ✅ 所有答案为纯文本显示，无输入框
- ✅ 没有编辑按钮
- ✅ 无法修改任何内容
- ✅ 页面顶部有"编辑"按钮可跳转到编辑模式

---

## 测试场景 3: 编辑与查看模式切换 ✅

### 3.1 从查看切换到编辑
**操作步骤**:
1. 在团队协作查看页面
2. 点击顶部的"编辑"按钮
3. 观察页面变化

**预期结果**:
- ✅ 跳转到编辑模式页面
- ✅ 只显示自己的答案组
- ✅ 所有答案可编辑
- ✅ 显示锁定/解锁/删除按钮

### 3.2 从编辑切换到查看
**操作步骤**:
1. 在编辑模式页面
2. 点击"返回"按钮
3. 从复盘列表点击"查看"按钮

**预期结果**:
- ✅ 返回到复盘列表
- ✅ 点击"查看"跳转到团队协作页面
- ✅ 显示所有成员的答案
- ✅ 所有答案只读

---

## 测试场景 4: API权限验证 ✅

### 4.1 编辑模式API调用
**操作步骤**:
1. 打开浏览器开发者工具（Network标签）
2. 进入编辑模式
3. 观察API请求

**预期结果**:
- ✅ 请求: `GET /api/answer-sets/:reviewId?mode=edit` (或默认无mode参数)
- ✅ 响应只包含当前用户的答案组
- ✅ 响应中答案组的user_id都等于当前用户ID

### 4.2 查看模式API验证
**操作步骤**:
1. 继续观察Network标签
2. 进入团队协作查看页面
3. 观察API请求

**预期结果**:
- ✅ 使用不同的API: `GET /api/reviews/:id/all-answers`
- ✅ 响应包含所有团队成员的答案
- ✅ 按问题和用户分组

---

## 测试场景 5: 个人复盘测试 ✅

### 5.1 个人复盘编辑
**操作步骤**:
1. 创建一个个人复盘（owner_type=personal）
2. 点击"编辑"按钮
3. 创建答案组

**预期结果**:
- ✅ 只显示自己的答案组
- ✅ 行为与编辑模式一致
- ✅ 无法创建团队协作

### 5.2 个人复盘查看
**操作步骤**:
1. 点击"查看"按钮查看个人复盘

**预期结果**:
- ✅ 显示标准的复盘详情页面
- ✅ 只显示自己的答案
- ✅ 不会跳转到团队协作页面

---

## 测试场景 6: 边界情况测试

### 6.1 无答案组时的状态
**操作步骤**:
1. 创建新的团队复盘
2. 立即进入编辑模式（不创建答案组）

**预期结果**:
- ✅ 显示"暂无答案组"或空状态
- ✅ 答案组导航显示"答案组 0/0"
- ✅ 提示创建第一个答案组

### 6.2 其他成员有答案但自己没有
**操作步骤**:
1. 账号A创建答案组
2. 账号B登录进入编辑模式

**预期结果**:
- ✅ 账号B看到空状态（0个答案组）
- ✅ 看不到账号A的答案组
- ✅ 可以创建自己的第一个答案组

### 6.3 答案组锁定状态
**操作步骤**:
1. 在编辑模式锁定自己的答案组
2. 切换到查看模式

**预期结果**:
- ✅ 编辑模式：锁定后不可编辑，显示锁定徽章
- ✅ 查看模式：可以看到锁定的答案（只读）

---

## 性能和用户体验测试

### 7.1 加载速度
**测试内容**:
- 编辑模式加载时间
- 查看模式加载时间
- 切换模式的响应速度

**预期结果**:
- ✅ 编辑模式加载更快（数据量更小）
- ✅ 查看模式略慢（需要加载所有成员数据）
- ✅ 切换流畅，无卡顿

### 7.2 界面清晰度
**测试内容**:
- 编辑模式界面简洁性
- 查看模式信息组织
- 用户理解成本

**预期结果**:
- ✅ 编辑模式更清爽，专注性更强
- ✅ 查看模式信息丰富但有序
- ✅ 用户能快速理解两种模式的区别

---

## 完整测试流程

### 测试脚本
```
1. 准备两个测试账号（A和B）
2. 账号A创建团队复盘
3. 账号A进入编辑模式，创建2个答案组
4. 验证：账号A只看到自己的2个答案组
5. 账号B登录，进入同一复盘编辑模式
6. 账号B创建1个答案组
7. 验证：账号B只看到自己的1个答案组
8. 账号A或B点击"查看"按钮
9. 验证：看到所有3个答案组（A的2个 + B的1个）
10. 在查看页面，验证所有答案只读
11. 点击"编辑"按钮返回编辑模式
12. 验证：又回到只看到自己的答案组
```

---

## 测试完成清单

- [ ] 测试场景1: 编辑模式 - 只显示自己的答案组
- [ ] 测试场景2: 查看模式 - 显示所有成员答案
- [ ] 测试场景3: 编辑与查看模式切换
- [ ] 测试场景4: API权限验证
- [ ] 测试场景5: 个人复盘测试
- [ ] 测试场景6: 边界情况测试
- [ ] 性能和用户体验测试

---

## 已知特性和注意事项

### 设计决策
1. **为什么编辑模式不显示他人答案？**
   - 减少干扰，提高专注度
   - 避免混淆（所有可见的都是可编辑的）
   - 简化界面逻辑

2. **如何查看他人答案？**
   - 使用"查看"按钮进入团队协作页面
   - 专门的只读查看界面
   - 按用户分组，清晰展示

3. **mode参数的作用**
   - API支持但前端默认行为已适配
   - 为未来功能扩展预留接口

### 技术细节
- **API端点**: GET /api/answer-sets/:reviewId?mode=edit|view
- **默认模式**: edit (编辑时只返回自己的)
- **查看模式**: 使用不同API (/api/reviews/:id/all-answers)
- **权限控制**: 后端基于user_id过滤

---

## 测试报告模板

**测试人员**: ___________  
**测试日期**: ___________  
**测试环境**: [ ] 开发环境 [ ] 生产环境  

**V9.2.1 → V9.3.0 对比测试**:
- [ ] 编辑模式：确认只显示自己的答案组
- [ ] 查看模式：确认显示所有成员答案
- [ ] 模式切换：流畅无问题
- [ ] API调用：正确使用mode参数

**测试结果**: [ ] 通过 [ ] 失败  

**问题记录**:
1. 
2. 

**用户反馈**:
- 编辑模式界面是否更清爽？
- 查看模式信息是否完整？
- 模式切换是否流畅？

---

## 联系方式
- **GitHub Issues**: https://github.com/Alan16168/review-system/issues
- **开发者**: Alan Deng
- **部署平台**: Cloudflare Pages
