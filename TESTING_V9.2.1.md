# V9.2.1 功能测试指南 - 答案编辑权限增强

## 版本信息
- **版本号**: V9.2.1
- **发布日期**: 2025-11-27
- **核心功能**: 每个成员只能编辑自己的答案，但可以查看其他成员的答案

## 测试环境
- **开发环境**: https://3000-i1l7k2pbfdion8sxilbu1-6532622b.e2b.dev
- **生产环境**: https://review-system.pages.dev
- **部署ID**: https://ab1646bb.review-system.pages.dev
- **GitHub**: https://github.com/Alan16168/review-system (Commit: 4204007)

---

## 🎯 核心功能测试

### 测试账号准备
建议准备两个测试账号进行团队协作测试：
- **账号A**: admin@review.com / admin123 (创建复盘和答案组)
- **账号B**: premium@review.com / premium123 (创建自己的答案组)

---

## 测试场景 1: 答案编辑权限控制 ✅

### 1.1 查看自己的答案组
**操作步骤**:
1. 使用账号A登录
2. 创建一个团队复盘（或打开已有的团队复盘）
3. 创建自己的答案组
4. 填写答案（单选题、多选题、文本题）

**预期结果**:
- ✅ 所有答案输入框可编辑
- ✅ 可以正常保存答案
- ✅ 显示"答案已自动保存"成功提示
- ✅ 锁定/解锁按钮可用
- ✅ 删除按钮可用（未锁定时）

### 1.2 查看其他成员的答案组
**操作步骤**:
1. 使用账号B登录
2. 打开账号A创建的团队复盘
3. 创建自己的答案组并填写答案
4. 切换到账号A的答案组（使用导航按钮）

**预期结果**:
- ✅ 可以看到账号A的所有答案内容
- ✅ 所有答案输入框自动禁用（灰色背景）
- ✅ 单选框/多选框无法点击
- ✅ 文本答案的编辑按钮被禁用
- ✅ 尝试点击输入框时显示提示："只能编辑自己的答案组"
- ✅ 锁定/解锁按钮被禁用（显示"只有答案组创建者可以锁定/解锁"提示）
- ✅ 删除按钮被禁用（显示"只有答案组创建者可以删除"提示）

### 1.3 尝试编辑他人答案（前端拦截）
**操作步骤**:
1. 继续使用账号B
2. 在查看账号A答案组时
3. 尝试点击单选框、多选框或编辑按钮

**预期结果**:
- ✅ 所有输入控件已被禁用，无法点击
- ✅ 如果通过开发者工具强制触发事件，后端会拦截并返回错误
- ✅ 显示警告提示："只能编辑自己的答案组"

---

## 测试场景 2: 锁定答案组的编辑限制 ✅

### 2.1 锁定自己的答案组
**操作步骤**:
1. 使用账号A登录
2. 打开自己的答案组
3. 点击"锁定"按钮

**预期结果**:
- ✅ 答案组被成功锁定
- ✅ 锁定按钮变为"解锁"（绿色）
- ✅ 导航区显示红色"🔒 已锁定"徽章
- ✅ 所有答案输入框自动禁用
- ✅ 删除按钮被禁用（提示："请先解锁答案组才能删除"）

### 2.2 尝试编辑已锁定的答案组（自己的）
**操作步骤**:
1. 在已锁定的答案组中
2. 尝试点击任何答案输入框

**预期结果**:
- ✅ 所有输入框已被禁用
- ✅ 显示警告："当前答案组已锁定，无法编辑"
- ✅ 解锁按钮仍然可用（只有所有者可以解锁）

### 2.3 解锁后恢复编辑
**操作步骤**:
1. 点击"解锁"按钮
2. 尝试编辑答案

**预期结果**:
- ✅ 答案组成功解锁
- ✅ 锁定徽章消失
- ✅ 所有输入框恢复可编辑状态
- ✅ 删除按钮恢复可用状态

---

## 测试场景 3: 答案组导航和信息显示 ✅

### 3.1 查看答案组创建者信息
**操作步骤**:
1. 使用账号B查看团队复盘
2. 使用"上一组"/"下一组"按钮浏览不同答案组

**预期结果**:
- ✅ 每个答案组显示创建者用户名
- ✅ 自己的答案组显示"(You)"标记
- ✅ 他人的答案组显示其用户名
- ✅ 锁定的答案组显示红色"🔒 已锁定"徽章

### 3.2 答案组切换时UI状态更新
**操作步骤**:
1. 在自己的答案组和他人的答案组之间切换

**预期结果**:
- ✅ 切换到自己的答案组：所有输入可编辑，按钮可用
- ✅ 切换到他人的答案组：所有输入禁用，按钮禁用
- ✅ UI状态切换流畅，无延迟
- ✅ 按钮状态和提示文本正确更新

---

## 测试场景 4: 多语言支持测试 ✅

### 4.1 测试不同语言的权限提示
**操作步骤**:
1. 在页面右上角切换语言
2. 尝试编辑他人的答案组
3. 观察提示信息

**预期结果**:
- ✅ **中文**: "只能编辑自己的答案组"
- ✅ **English**: "You can only edit your own answer sets"
- ✅ **日本語**: "自分の回答グループのみ編集できます"
- ✅ **Español**: "Solo puedes editar tus propios conjuntos de respuestas"

### 4.2 测试锁定/删除按钮的多语言提示
**操作步骤**:
1. 切换语言
2. 鼠标悬停在禁用的锁定/删除按钮上
3. 查看tooltip提示

**预期结果**:
- ✅ 锁定按钮提示根据语言正确显示
- ✅ 删除按钮提示根据语言正确显示

---

## 测试场景 5: API权限控制测试 ✅

### 5.1 后端API权限拦截
**操作步骤**:
1. 使用浏览器开发者工具
2. 尝试通过API直接修改他人的答案组
3. 构造PUT请求到 `/api/answer-sets/:reviewId/:setNumber`

**预期结果**:
- ✅ 后端返回403错误
- ✅ 错误信息："Not authorized to modify this answer set"
- ✅ 答案未被修改

---

## 功能对比表

| 功能 | V9.2.0 (之前) | V9.2.1 (现在) |
|------|---------------|---------------|
| 查看所有答案组 | ✅ 支持 | ✅ 支持 |
| 查看他人答案 | ✅ 支持 | ✅ 支持 |
| 编辑他人答案 | ⚠️ 可以编辑（无限制） | ❌ 不可编辑 |
| 编辑自己答案 | ✅ 可以 | ✅ 可以 |
| 锁定答案组 | ✅ 仅创建者 | ✅ 仅创建者 |
| 删除答案组 | ✅ 仅创建者 | ✅ 仅创建者 |
| UI状态控制 | ⚠️ 仅锁定控制 | ✅ 锁定+所有权双重控制 |
| 权限提示 | ⚠️ 仅锁定提示 | ✅ 完整权限提示 |

---

## 边界情况测试

### 6.1 复盘类型切换
**测试内容**:
- 从团队复盘切换到个人复盘
- 从个人复盘切换到团队复盘

**预期结果**:
- ✅ 个人复盘只显示自己的答案组
- ✅ 团队复盘显示所有成员的答案组
- ✅ 切换时UI正确更新

### 6.2 答案组为空时
**测试内容**:
- 查看没有任何答案的答案组
- 他人的空答案组

**预期结果**:
- ✅ 显示"此答案组暂无答案"
- ✅ 自己的空答案组可以添加答案
- ✅ 他人的空答案组不可添加答案

### 6.3 网络错误处理
**测试内容**:
- 模拟网络中断
- 在保存答案时断网

**预期结果**:
- ✅ 显示"自动保存失败"提示
- ✅ 不会影响当前页面状态
- ✅ 重新联网后可继续操作

---

## 性能测试

### 7.1 大量答案组的性能
**测试内容**:
- 创建10个以上答案组
- 快速切换答案组

**预期结果**:
- ✅ 切换流畅，无明显延迟
- ✅ UI状态更新及时
- ✅ 内存占用正常

---

## 测试完成清单

- [ ] 测试场景1: 答案编辑权限控制
- [ ] 测试场景2: 锁定答案组的编辑限制
- [ ] 测试场景3: 答案组导航和信息显示
- [ ] 测试场景4: 多语言支持测试
- [ ] 测试场景5: API权限控制测试
- [ ] 边界情况测试
- [ ] 性能测试

---

## 已知问题和注意事项

### 注意事项
1. **权限检查双重保障**: 前端UI禁用 + 后端API拦截
2. **所有权判断**: 基于 `currentSet.user_id === currentUserId`
3. **锁定状态判断**: 基于 `currentSet.is_locked === 'yes'`
4. **UI状态同步**: 切换答案组时自动更新所有UI状态

### 技术细节
- **前端函数**: updateAnswerInSet, updateMultipleChoiceInSet, saveInlineAnswer
- **UI控制函数**: updateAnswerEditability(isLocked, isOwnSet)
- **权限检查**: 在保存答案前检查所有权和锁定状态
- **多语言键**: onlyOwnerCanEditAnswers

---

## 测试报告模板

**测试人员**: ___________  
**测试日期**: ___________  
**测试环境**: [ ] 开发环境 [ ] 生产环境  
**测试结果**: [ ] 通过 [ ] 失败  

**问题记录**:
1. 
2. 
3. 

**建议和改进**:
1. 
2. 
3. 

---

## 联系方式
- **GitHub Issues**: https://github.com/Alan16168/review-system/issues
- **开发者**: Alan Deng
- **部署平台**: Cloudflare Pages
