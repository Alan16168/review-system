# ğŸ¯ D1 æ•°æ®åº“ç»‘å®šé…ç½® - è¶…è¯¦ç»†æ­¥éª¤

## ğŸ“Œ å‰ç½®è¯´æ˜

- **æ‰€éœ€æ—¶é—´**: 5 åˆ†é’Ÿ
- **æƒé™è¦æ±‚**: Cloudflare è´¦æˆ·ç®¡ç†å‘˜æƒé™
- **é…ç½®ä½ç½®**: Cloudflare Dashboard
- **é¡¹ç›®åç§°**: review-system
- **æ•°æ®åº“åç§°**: review-system-production

---

## ç¬¬ 1 æ­¥: ç™»å½• Cloudflare Dashboard

### æ“ä½œ:
1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—®: **https://dash.cloudflare.com/**
3. è¾“å…¥ä½ çš„ Cloudflare è´¦æˆ·é‚®ç®±å’Œå¯†ç 
4. ç‚¹å‡» "Log in" ç™»å½•

### é¢„æœŸç»“æœ:
âœ… è¿›å…¥ Cloudflare ä¸»æ§åˆ¶é¢æ¿

---

## ç¬¬ 2 æ­¥: è¿›å…¥ Workers & Pages

### æ“ä½œ:
1. åœ¨å·¦ä¾§èœå•æ æ‰¾åˆ° **"Workers & Pages"** (å›¾æ ‡æ˜¯ âš¡ é—ªç”µ)
2. ç‚¹å‡» "Workers & Pages"

### é¢„æœŸç»“æœ:
âœ… çœ‹åˆ°ä½ çš„æ‰€æœ‰ Workers å’Œ Pages é¡¹ç›®åˆ—è¡¨

---

## ç¬¬ 3 æ­¥: æ‰¾åˆ° review-system é¡¹ç›®

### æ“ä½œ:
1. åœ¨é¡¹ç›®åˆ—è¡¨ä¸­æ‰¾åˆ° **"review-system"**
2. ç‚¹å‡»é¡¹ç›®åç§° "review-system" è¿›å…¥é¡¹ç›®è¯¦æƒ…

### å¦‚æœæ‰¾ä¸åˆ°é¡¹ç›®:
- æ£€æŸ¥é¡µé¢é¡¶éƒ¨çš„ç­›é€‰å™¨æ˜¯å¦é€‰æ‹©äº† "Pages"
- ä½¿ç”¨æœç´¢æ¡†æœç´¢ "review-system"

### é¢„æœŸç»“æœ:
âœ… è¿›å…¥ review-system é¡¹ç›®çš„æ¦‚è§ˆé¡µé¢

---

## ç¬¬ 4 æ­¥: è¿›å…¥ Settings (è®¾ç½®)

### æ“ä½œ:
1. åœ¨é¡¹ç›®é¡µé¢é¡¶éƒ¨,æ‰¾åˆ°æ ‡ç­¾æ 
2. æ ‡ç­¾åŒ…æ‹¬: Deployments | Settings | ...
3. ç‚¹å‡» **"Settings"** æ ‡ç­¾

### é¢„æœŸç»“æœ:
âœ… è¿›å…¥é¡¹ç›®è®¾ç½®é¡µé¢

---

## ç¬¬ 5 æ­¥: æ‰¾åˆ° Functions è®¾ç½®

### æ“ä½œ:
1. åœ¨ Settings é¡µé¢å‘ä¸‹æ»šåŠ¨
2. æ‰¾åˆ° **"Functions"** éƒ¨åˆ† (é€šå¸¸åœ¨é¡µé¢ä¸­é—´åä¸‹çš„ä½ç½®)
3. ç»§ç»­å‘ä¸‹æ»šåŠ¨,æ‰¾åˆ° **"D1 database bindings"** å­éƒ¨åˆ†

### é¢„æœŸç»“æœ:
âœ… çœ‹åˆ° "D1 database bindings" åŒºåŸŸ,å¯èƒ½æ˜¾ç¤º "No bindings" æˆ–å·²æœ‰çš„ç»‘å®š

---

## ç¬¬ 6 æ­¥: æ·»åŠ ç”Ÿäº§ç¯å¢ƒç»‘å®š (Production)

### æ“ä½œ:

#### 6.1 ç‚¹å‡» Add binding
- åœ¨ "D1 database bindings" åŒºåŸŸ
- ç‚¹å‡» **"Add binding"** æŒ‰é’®

#### 6.2 å¡«å†™ç»‘å®šä¿¡æ¯
ä¼šå¼¹å‡ºä¸€ä¸ªé…ç½®è¡¨å•,å¡«å†™ä»¥ä¸‹ä¿¡æ¯:

**å­—æ®µ 1: Variable name (å˜é‡å)**
```
DB
```
âš ï¸ **é‡è¦**: å¿…é¡»å®Œå…¨åŒ¹é… `DB`,åŒºåˆ†å¤§å°å†™,ä¸èƒ½æœ‰ç©ºæ ¼

**å­—æ®µ 2: D1 database (æ•°æ®åº“)**
- ç‚¹å‡»ä¸‹æ‹‰èœå•
- é€‰æ‹© **`review-system-production`**

**å­—æ®µ 3: Environment (ç¯å¢ƒ)**
- ç‚¹å‡»ä¸‹æ‹‰èœå•  
- é€‰æ‹© **`Production`**

#### 6.3 ä¿å­˜é…ç½®
- æ£€æŸ¥æ‰€æœ‰ä¿¡æ¯æ˜¯å¦æ­£ç¡®
- ç‚¹å‡» **"Save"** æˆ– **"Add binding"** æŒ‰é’®

### é¢„æœŸç»“æœ:
âœ… çœ‹åˆ°æ–°å¢çš„ç»‘å®šæ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­:
```
Variable name: DB
D1 database: review-system-production
Environment: Production
```

---

## ç¬¬ 7 æ­¥: æ·»åŠ é¢„è§ˆç¯å¢ƒç»‘å®š (Preview) - å¯é€‰ä½†æ¨è

### æ“ä½œ:

#### 7.1 å†æ¬¡ç‚¹å‡» Add binding
- åœ¨åŒä¸€ä¸ª "D1 database bindings" åŒºåŸŸ
- å†æ¬¡ç‚¹å‡» **"Add binding"** æŒ‰é’®

#### 7.2 å¡«å†™é¢„è§ˆç¯å¢ƒç»‘å®šä¿¡æ¯

**Variable name**: `DB`  
**D1 database**: é€‰æ‹© `review-system-production`  
**Environment**: é€‰æ‹© **`Preview`**

#### 7.3 ä¿å­˜
- ç‚¹å‡» **"Save"** æˆ– **"Add binding"** æŒ‰é’®

### é¢„æœŸç»“æœ:
âœ… ç°åœ¨æœ‰ä¸¤ä¸ªç»‘å®š:
```
1. Variable name: DB | Database: review-system-production | Environment: Production
2. Variable name: DB | Database: review-system-production | Environment: Preview
```

---

## ç¬¬ 8 æ­¥: éªŒè¯é…ç½®

### æ“ä½œ:
1. æ‰“å¼€æ–°æ ‡ç­¾é¡µ
2. è®¿é—®: **https://review-system.pages.dev**
3. **å¼ºåˆ¶åˆ·æ–°é¡µé¢**: æŒ‰ `Ctrl + Shift + R` (Windows/Linux) æˆ– `Cmd + Shift + R` (Mac)
4. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·: æŒ‰ `F12`
5. åˆ‡æ¢åˆ° **"Console"** æ ‡ç­¾

### æµ‹è¯•è´­ç‰©è½¦åŠŸèƒ½:
1. ç™»å½•ä½ çš„è´¦æˆ·
2. ç‚¹å‡»ä»»æ„å¥—é¤çš„ **"ç«‹å³è®¢é˜…"** æŒ‰é’®
3. è§‚å¯Ÿ Console å’Œé¡µé¢ååº”

### é¢„æœŸç»“æœ - é…ç½®æˆåŠŸ:
âœ… **Console æ˜¾ç¤º**:
```
âœ… User authenticated: { userId: X, email: "..." }
ğŸ“¦ Request body: { item_type: "subscription", ... }
âœ… Fields validated: { subscription_tier: "premium", ... }
âœ… Item added to cart: { ... }
```

âœ… **é¡µé¢æ˜¾ç¤º**: 
- å¼¹å‡º "å·²åŠ å…¥è´­ç‰©è½¦" æˆåŠŸæç¤º
- è´­ç‰©è½¦å›¾æ ‡æ˜¾ç¤ºæ•°é‡å¾½ç« 

âœ… **Network æ ‡ç­¾**:
- POST /api/cart/add â†’ 200 OK
- GET /api/cart â†’ 200 OK (è¿”å›å•†å“åˆ—è¡¨)

### å¦‚æœä»ç„¶å‡ºé”™:
âŒ **Console æ˜¾ç¤º**:
```
âŒ DB binding is not available in c.env
```

**è§£å†³æ–¹æ³•**:
1. ç­‰å¾… 2-3 åˆ†é’Ÿ (é…ç½®éœ€è¦æ—¶é—´ç”Ÿæ•ˆ)
2. å¼ºåˆ¶åˆ·æ–°é¡µé¢ (Ctrl + Shift + R)
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡è¯•
4. æ£€æŸ¥ Cloudflare Dashboard ç¡®è®¤ç»‘å®šå·²ä¿å­˜

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: æ‰¾ä¸åˆ° "D1 database bindings" é€‰é¡¹?
**A**: 
- ç¡®ä¿ä½ åœ¨ "Settings" æ ‡ç­¾é¡µ
- å‘ä¸‹æ»šåŠ¨åˆ° "Functions" éƒ¨åˆ†
- å¦‚æœè¿˜æ˜¯æ²¡æœ‰,æ£€æŸ¥ä½ çš„ Cloudflare è´¦æˆ·æƒé™

### Q2: ä¸‹æ‹‰èœå•ä¸­æ²¡æœ‰ "review-system-production"?
**A**: 
1. è¿”å› Cloudflare ä¸»é¡µ
2. å·¦ä¾§èœå•ç‚¹å‡» "D1"
3. æŸ¥çœ‹æ˜¯å¦æœ‰ "review-system-production" æ•°æ®åº“
4. å¦‚æœæ²¡æœ‰,ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»º:
   ```bash
   cd /home/user/webapp
   npx wrangler d1 create review-system-production
   ```
5. å°†è¿”å›çš„ database_id æ›´æ–°åˆ° wrangler.jsonc

### Q3: ä¿å­˜åè¿˜æ˜¯ 500 é”™è¯¯?
**A**: 
1. ç­‰å¾… 2-3 åˆ†é’Ÿè®©é…ç½®ç”Ÿæ•ˆ
2. å¼ºåˆ¶åˆ·æ–°é¡µé¢ (Ctrl + Shift + R)
3. æ£€æŸ¥ Variable name æ˜¯å¦å®Œå…¨åŒ¹é… "DB" (åŒºåˆ†å¤§å°å†™)
4. æ£€æŸ¥ Environment æ˜¯å¦é€‰æ‹©äº† "Production"

### Q4: Preview ç¯å¢ƒæ˜¯ä»€ä¹ˆ?
**A**: 
- Preview ç”¨äºéƒ¨ç½²é¢„è§ˆ (éç”Ÿäº§ç¯å¢ƒ)
- å½“ä½  push åˆ°é main åˆ†æ”¯æ—¶ä¼šç”¨åˆ°
- é…ç½®åå¯ä»¥åœ¨é¢„è§ˆç¯å¢ƒä¹Ÿèƒ½æµ‹è¯•æ•°æ®åº“åŠŸèƒ½

---

## âœ… é…ç½®å®Œæˆæ£€æŸ¥æ¸…å•

å®Œæˆé…ç½®å,æ£€æŸ¥ä»¥ä¸‹å„é¡¹:

- [ ] Cloudflare Dashboard æ˜¾ç¤º Production ç»‘å®š
- [ ] Cloudflare Dashboard æ˜¾ç¤º Preview ç»‘å®š (å¯é€‰)
- [ ] Variable name æ˜¯ `DB` (å®Œå…¨åŒ¹é…)
- [ ] D1 database æ˜¯ `review-system-production`
- [ ] ç½‘ç«™å¼ºåˆ¶åˆ·æ–°åæµ‹è¯•
- [ ] è´­ç‰©è½¦æ·»åŠ åŠŸèƒ½æ­£å¸¸
- [ ] è´­ç‰©è½¦æŸ¥çœ‹åŠŸèƒ½æ­£å¸¸
- [ ] ç•Œé¢è®¾ç½®åŠ è½½æ­£å¸¸ (ç®¡ç†å‘˜)
- [ ] Console æ²¡æœ‰ 500 é”™è¯¯
- [ ] Network æ ‡ç­¾æ˜¾ç¤º 200 OK

---

## ğŸ“ éœ€è¦å¸®åŠ©?

å¦‚æœé…ç½®åè¿˜æœ‰é—®é¢˜,è¯·æä¾›:

1. **Cloudflare Dashboard æˆªå›¾**:
   - Settings â†’ Functions â†’ D1 database bindings åŒºåŸŸçš„æˆªå›¾

2. **æµè§ˆå™¨ Console æˆªå›¾**:
   - F12 â†’ Console æ ‡ç­¾çš„å®Œæ•´æ—¥å¿—

3. **Network æ ‡ç­¾æˆªå›¾**:
   - F12 â†’ Network æ ‡ç­¾
   - æ‰¾åˆ°å¤±è´¥çš„ API è¯·æ±‚
   - ç‚¹å‡»è¯·æ±‚,æŸ¥çœ‹ Response æ ‡ç­¾

4. **å…·ä½“æ“ä½œæ­¥éª¤**:
   - ä½ åšäº†ä»€ä¹ˆæ“ä½œ
   - é¢„æœŸç»“æœæ˜¯ä»€ä¹ˆ
   - å®é™…ç»“æœæ˜¯ä»€ä¹ˆ

---

## ğŸ¯ é…ç½®åçš„ç«‹å³æ•ˆæœ

é…ç½®å®Œ D1 ç»‘å®šå,**æ— éœ€é‡æ–°éƒ¨ç½²ä»£ç **,ä»¥ä¸‹åŠŸèƒ½ç«‹å³å¯ç”¨:

âœ… **è´­ç‰©è½¦ç³»ç»Ÿ**:
- æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
- æŸ¥çœ‹è´­ç‰©è½¦å†…å®¹
- åˆ é™¤è´­ç‰©è½¦å•†å“
- æ¸…ç©ºè´­ç‰©è½¦
- è®¡ç®—è´­ç‰©è½¦æ€»ä»·

âœ… **ç•Œé¢è®¾ç½®ç³»ç»Ÿ**:
- ç®¡ç†åå°åŠ è½½ç•Œé¢è®¾ç½®
- ä¿®æ”¹ç³»ç»Ÿæ ‡é¢˜ã€æè¿°ç­‰
- ä¿å­˜åä¸»é¡µç«‹å³æ›´æ–°

âœ… **æ‰€æœ‰æ•°æ®åº“åŠŸèƒ½**:
- ç”¨æˆ·ç®¡ç†
- å¤ç›˜è®°å½•
- å›¢é˜Ÿåä½œ
- è®¢é˜…ç®¡ç†
- ç³»ç»Ÿé…ç½®

---

**é…ç½®åªéœ€ 5 åˆ†é’Ÿ,ä½†èƒ½è§£é”æ‰€æœ‰æ•°æ®åº“åŠŸèƒ½!** ğŸš€
